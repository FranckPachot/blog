<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>19c Auto Index: the dictionary views</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">19c Auto Index: the dictionary views</h1>
</header>
<section data-field="subtitle" class="p-summary">
The abbreviation AI may be misleading but it has nothing to do with Artificial intelligence. And you may have been surprised that the ‘A’…
</section>
<section data-field="body" class="e-content">
<section name="2f6e" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="568d" id="568d" class="graf graf--h3 graf--leading graf--title">19c Auto Index: the dictionary views</h3><p name="23e2" id="23e2" class="graf graf--p graf-after--h3">The abbreviation AI may be misleading but it has nothing to do with Artificial Intelligence. And you may have been surprised that the ‘A’ means ‘Automatic’ rather than ‘Autonomous’ as the latter is constantly used to tag any new feature in the database since 18c. But this difference is really important: ‘<strong class="markup--strong markup--p-strong">Autonomous</strong>’ supposes that you don’t have anything to do and don’t even need to be notified about what happened. On the opposite, ‘<strong class="markup--strong markup--p-strong">Automatic</strong>’ means that some things are done without your intervention, in order to help you, but you are still in charge of managing them. And you need to look at the dictionary views, to be aware of the findings, recommendations, and implementations. Automatic Indexing is an evolution of the <strong class="markup--strong markup--p-strong">Advisors</strong> that were introduced since 10g and, in the same way, it provides many dictionary views to understand its activity.</p><p name="aa31" id="aa31" class="graf graf--p graf-after--p">This posts present those views, mainly defined in the catproc script $ORACLE_HOME/rdbms/admin/cataivw.sql, grouped in the following areas:</p><ul class="postList"><li name="d56d" id="d56d" class="graf graf--li graf-after--p">Configuration</li><li name="5b4a" id="5b4a" class="graf graf--li graf-after--li">Activity log</li><li name="7492" id="7492" class="graf graf--li graf-after--li">Indexes created</li><li name="0ac3" id="0ac3" class="graf graf--li graf-after--li">SQL statements</li></ul><h3 name="c1e2" id="c1e2" class="graf graf--h3 graf-after--li">Automatic Indexing — Configuration Parameters</h3><h4 name="aba9" id="aba9" class="graf graf--h4 graf-after--h3">DBA_AUTO_INDEX_CONFIG</h4><p name="beea" id="beea" class="graf graf--p graf-after--h4">The configuration parameters are displayed with this view.</p><p name="d58f" id="d58f" class="graf graf--p graf-after--p">Here I’ve set AUTO_INDEX_MODE to run and automatically implement its findings:</p><pre name="ec2b" id="ec2b" class="graf graf--pre graf-after--p">exec dbms_auto_index.configure(&#39;auto_index_mode&#39;,&#39;implement&#39;);</pre><p name="1a8f" id="1a8f" class="graf graf--p graf-after--pre">The other parameters are the default:</p><pre name="8d7d" id="8d7d" class="graf graf--pre graf-after--p">select * from dba_auto_index_config order by 1;</pre><pre name="af2c" id="af2c" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">PARAMETER_NAME                    PARAMETER_VALUE   LAST_MODIFIED</strong><br>AUTO_INDEX_DEFAULT_TABLESPACE<br>AUTO_INDEX_MODE                   IMPLEMENT         14:20:12<br>AUTO_INDEX_REPORT_RETENTION       31<br>AUTO_INDEX_RETENTION_FOR_AUTO     373<br>AUTO_INDEX_RETENTION_FOR_MANUAL<br>AUTO_INDEX_SCHEMA<br>AUTO_INDEX_SPACE_BUDGET           50</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="2f5d" id="2f5d" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 106px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 10.299999999999999%;"></div><img class="graf-image" data-image-id="1*-xk1JDAS5AYf_K_ZiyYXMw.png" data-width="2404" data-height="247" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1200/1*-xk1JDAS5AYf_K_ZiyYXMw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="5934" id="5934" class="graf graf--p graf-after--figure">Actually, the table behind this view is SMB$CONFIG which is from the SQL Management Base. SMB stores what the optimizer needs to persist about SQL statements: SQL Profiles, SQL Plan Baselines, SQL Patches and in 19c SQL Quarantine. And Automatic Indexing is heavily linked with them to control the scope of its implementations.</p><h4 name="6ccf" id="6ccf" class="graf graf--h4 graf-after--p">SMB$CONFIG</h4><p name="3f37" id="3f37" class="graf graf--p graf-after--h4">SMB$CONFIG shows additional underscore parameters.</p><pre name="af63" id="af63" class="graf graf--pre graf-after--p">select * from sys.smb$config where parameter_name like &#39;%AUTO_INDEX%&#39; order by 1;</pre><p name="6324" id="6324" class="graf graf--p graf-after--pre">Here I’ve set _AUTO_INDEX_TRACE to the value 2 to get more tracing in the job trace. I’ve set it with:</p><pre name="f868" id="f868" class="graf graf--pre graf-after--p">exec sys.dbms_auto_index_internal.configure( &#39;_AUTO_INDEX_TRACE&#39;, 2, allow_internal=&gt;true);</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="a84f" id="a84f" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 196px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 19%;"></div><img class="graf-image" data-image-id="1*lf2WefX-U4thBm3j50EBvw.png" data-width="2432" data-height="461" src="https://cdn-images-1.medium.com/max/1200/1*lf2WefX-U4thBm3j50EBvw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="dd47" id="dd47" class="graf graf--h4 graf-after--figure">DBA_ADVISOR_TASKS</h4><p name="a501" id="a501" class="graf graf--p graf-after--h4">Automatic Indexing is based on the Optimizer Advisor Framework. Here are the new Advisor tasks:</p><pre name="2e40" id="2e40" class="graf graf--pre graf-after--p">SQL&gt; select * from dba_advisor_tasks where owner=&#39;SYS&#39; order by task_id;</pre><pre name="acd4" id="acd4" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">TASK_ID TASK_NAME                          ADVISOR_NAME<br></strong>      2 SYS_AUTO_SPM_EVOLVE_TASK           SPM Evolve Advisor<br>      3 SYS_AI_SPM_EVOLVE_TASK             SPM Evolve Advisor<br>      4 SYS_AI_VERIFY_TASK                 SQL Performance Analyzer<br>      5 SYS_AUTO_INDEX_TASK                SQL Access Advisor<br>      6 AUTO_STATS_ADVISOR_TASK            Statistics Advisor<br>      7 INDIVIDUAL_STATS_ADVISOR_TASK      Statistics Advisor</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="cf8f" id="cf8f" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 97px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 9.4%;"></div><img class="graf-image" data-image-id="1*w6qo6bwLjBRJG25WGrERgg.png" data-width="2418" data-height="228" src="https://cdn-images-1.medium.com/max/1200/1*w6qo6bwLjBRJG25WGrERgg.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="66af" id="66af" class="graf graf--h3 graf-after--figure">Automatic Indexing — Activity Log</h3><h4 name="7daf" id="7daf" class="graf graf--h4 graf-after--h3">DBA_ADVISOR_EXECUTIONS</h4><p name="f2bf" id="f2bf" class="graf graf--p graf-after--h4">The standard Advisor views can give information about the Auto Indexing activity. The TASK_ID=5 and TASK_NAME=SYS_AUTO_INDEX_TASK</p><pre name="b30c" id="b30c" class="graf graf--pre graf-after--p">select * from dba_advisor_executions where task_name=&#39;SYS_AUTO_INDEX_TASK&#39; order by execution_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="e7be" id="e7be" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 264px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 25.6%;"></div><img class="graf-image" data-image-id="1*wGpWqtdUBkXtIrAtkIP4Aw.png" data-width="2431" data-height="623" src="https://cdn-images-1.medium.com/max/1200/1*wGpWqtdUBkXtIrAtkIP4Aw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="9498" id="9498" class="graf graf--h4 graf-after--figure">DBA_AUTO_INDEX_EXECUTIONS</h4><p name="fc47" id="fc47" class="graf graf--p graf-after--h4">You don’t need to go to those views because Auto Indexing provides specific ones, based on the same WRI$_ADV_TASKS and WRI$_ADV_EXECUTIONS tables.</p><pre name="316e" id="316e" class="graf graf--pre graf-after--p">select * from dba_auto_index_executions order by execution_start;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="9178" id="9178" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 144px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 14.000000000000002%;"></div><img class="graf-image" data-image-id="1*mWC7AiOjNzvuZAs9QNSSaA.png" data-width="2420" data-height="338" src="https://cdn-images-1.medium.com/max/1200/1*mWC7AiOjNzvuZAs9QNSSaA.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="7196" id="7196" class="graf graf--h4 graf-after--figure">DBA_ADVISOR_OBJECTS</h4><p name="a64d" id="a64d" class="graf graf--p graf-after--h4">The Advisor Framework stores additional information as objects in WRI$_ADV_OBJECTS. The Automatic Indexing ones are the log information from its activity, with TYPE_ID=31 and TYPE=’AUTO INDEX INFORMATION’ (these types are defined in X$KEAOBJT)</p><pre name="e07a" id="e07a" class="graf graf--pre graf-after--p">select * from dba_advisor_objects where task_name=&#39;SYS_AUTO_INDEX_TASK&#39; and type=&#39;AUTO INDEX INFORMATION&#39;order by object_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="e913" id="e913" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 225px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 21.8%;"></div><img class="graf-image" data-image-id="1*6-puGps60IOxNquZsbhWwA.png" data-width="2433" data-height="530" src="https://cdn-images-1.medium.com/max/1200/1*6-puGps60IOxNquZsbhWwA.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="ced8" id="ced8" class="graf graf--h4 graf-after--figure">dbms_auto_index_internal.finding_name(attr7)</h4><p name="5d12" id="5d12" class="graf graf--p graf-after--h4">Those Advisor views show general attributes that have a different signification for each object type, and for AUTO INDEX INFORMATION the ATTR7 identifies the finding. Those, as far as I know, are not visible from a table but hardcoded in the DBMS_AUTO_INDEX_INTERNAL function. Here are all possible values:</p><pre name="a66e" id="a66e" class="graf graf--pre graf-after--p">SQL&gt; select attr7,sys.dbms_auto_index_internal.finding_name(attr7) from (select rownum attr7 from xmltable(&#39;1 to 51&#39;)) order by 1;</pre><pre name="8317" id="8317" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">  ATTR7 SYS.DBMS_AUTO_INDEX_INTERNAL.FINDING_NAME(ATTR7)<br></strong>      1 Compiled statements<br>      2 Statements using auto index in compilation verification(final)<br>      3 Statements discarded (misestimate or high selectivity of indexes)<br>      4 New index candidate<br>      5 Candidate indexes<br>      6 Index for rebuild<br>      7 Rebuilt indexes<br>      8 Redundant index<br>      9 Redundant indexes<br>     10 Misestimate in sql_id<br>     11 Pruned indexes<br>     12 SPM begin<br>     13 Statements considered by SPM<br>     14 Indexes in first verification<br>     15 Indexes in second verification<br>     16 No significant improvement with index<br>     17 Ineffective indexes<br>     18 Significant improvement with index<br>     19 Effective indexes<br>     20 Error for statement<br>     21 Timeout for statement<br>     22 No buffer gets for statement<br>     23 Statement regressed or no significant improvement<br>     24 Regressed statements<br>     25 Statement produced same plan<br>     26 Statement has same performance<br>     27 Unchanged statements<br>     28 Statement improved<br>     29 Improved statements<br>     30 Index created<br>     31 Index dropped<br>     32 Index rebuilt<br>     33 Index marked unusable<br>     34 Index marked visible<br>     35 Index marked invisible<br>     36<br>     37 Auto index clean up work done<br>     38 Execution validation for mis-estimated statements done<br>     39 Auto index action based on performance validation done<br>     40 Auto index compilation verification done<br>     41 Statements using auto index in compilation verification<br>     42 SPM end<br>     43 Max space budget reached<br>     44 Report mode, performance validated but index stays invisible<br>     45 Out-of-space during rebuild<br>     46 Statements in STS<br>     47 Auto index execution start<br>     48 Resuming auto index execution<br>     49 Skipping table from auto index creation<br>     50 Auto index execution end<br>     51 Implement validated auto index</pre><h4 name="e534" id="e534" class="graf graf--h4 graf--startsWithDoubleQuote graf-after--pre">“_auto_index_log”</h4><p name="9333" id="9333" class="graf graf--p graf-after--h4">Oracle has an internal view to display the advisor objects as a log of its activity:</p><pre name="ef79" id="ef79" class="graf graf--pre graf-after--p">select * from sys.&quot;_auto_index_log&quot; order by log_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="b7f2" id="b7f2" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 462px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 44.800000000000004%;"></div><img class="graf-image" data-image-id="1*ovLfMfxBfz8n11bO9Uiibg.png" data-width="2428" data-height="1087" src="https://cdn-images-1.medium.com/max/1200/1*ovLfMfxBfz8n11bO9Uiibg.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="8013" id="8013" class="graf graf--p graf-after--figure">Unfortunately, there’s no public dictionary view on it except an aggregated one to sum the statistics.</p><h4 name="d247" id="d247" class="graf graf--h4 graf-after--p">DBA_AUTO_INDEX_STATISTICS</h4><p name="3a36" id="3a36" class="graf graf--p graf-after--h4">Based on “_auto_index_log” we have some summary counters</p><pre name="513a" id="513a" class="graf graf--pre graf-after--p">select * from dba_auto_index_statistics where value&gt;0 order by 1;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="c18d" id="c18d" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 109px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 10.6%;"></div><img class="graf-image" data-image-id="1*B15xlg3Gv3GX3Hly5t41hQ.png" data-width="2426" data-height="257" src="https://cdn-images-1.medium.com/max/1200/1*B15xlg3Gv3GX3Hly5t41hQ.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="1896" id="1896" class="graf graf--h3 graf-after--figure">Automatic Indexing — New Indexes</h3><h4 name="38a1" id="38a1" class="graf graf--h4 graf-after--h3">DBA_ADVISOR_OBJECTS</h4><p name="cc35" id="cc35" class="graf graf--p graf-after--h4">The goal of Auto Indexing activity is to create (and drop) indexes and this index information is stored as objects with TYPE_ID=2 and TYPE=’INDEX’ in the Advisor Framework objects</p><pre name="4fa3" id="4fa3" class="graf graf--pre graf-after--p">select * from dba_advisor_objects where task_name=&#39;SYS_AUTO_INDEX_TASK&#39; and type=&#39;INDEX&#39; order by object_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="cf9d" id="cf9d" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 85px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 8.3%;"></div><img class="graf-image" data-image-id="1*ObhjcLAUZZ_FCrDbDT7_dg.png" data-width="2424" data-height="200" src="https://cdn-images-1.medium.com/max/1200/1*ObhjcLAUZZ_FCrDbDT7_dg.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="382a" id="382a" class="graf graf--h4 graf--startsWithDoubleQuote graf-after--figure">“_auto_index_ind_objects”</h4><p name="e39f" id="e39f" class="graf graf--p graf-after--h4">This internal view decodes the attributes in the context of Automatic Indexes to display more information about the created indexes</p><pre name="5fc9" id="5fc9" class="graf graf--pre graf-after--p">select * from sys.&quot;_auto_index_ind_objects&quot; order by object_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="e3d5" id="e3d5" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 88px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 8.6%;"></div><img class="graf-image" data-image-id="1*PvbykWeq-qQOm9PZDD-TVg.png" data-width="2431" data-height="208" src="https://cdn-images-1.medium.com/max/1200/1*PvbykWeq-qQOm9PZDD-TVg.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="6997" id="6997" class="graf graf--h4 graf-after--figure">DBA_INDEXES</h4><p name="d954" id="d954" class="graf graf--p graf-after--h4">The full metadata is available from the dictionary views about indexes. The name of those indexes start with ‘SYS_AI_’ and are flagged with this new AUTO column.</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="f1d4" id="f1d4" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 282px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 27.3%;"></div><img class="graf-image" data-image-id="1*OxX-Xz9dKbxdn54yF0iM_A.png" data-width="2434" data-height="665" src="https://cdn-images-1.medium.com/max/1200/1*OxX-Xz9dKbxdn54yF0iM_A.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="32a9" id="32a9" class="graf graf--p graf-after--figure">The DDL as generated by DBMS_METADATA has this AUTO attribute, but we cannot use it ourselves. The tablespace here is SYSTEM because I’ve not set the configuration AUTO_INDEX_DEFAULT_TABLESPACE parameter. It seems that 12cR2 ADVANCED LOW compression is used. I’ll update this post when having more information about the licensing consequences. [<em class="markup--em markup--p-em">Update: I raised the point and a new parameter should come in 19.3</em>]</p><p name="38f3" id="38f3" class="graf graf--p graf-after--p">DBA_AUTO_INDEX_IND_ACTIONS</p><p name="f4af" id="f4af" class="graf graf--p graf-after--p">A public view is available to see the commands that were executed to create this index, which shows the different steps:</p><ul class="postList"><li name="b56f" id="b56f" class="graf graf--li graf-after--p">created as unusable to analyze the execution plans</li><li name="1242" id="1242" class="graf graf--li graf-after--li">rebuilt (online) but invisible to control which statements will verify it</li><li name="53e0" id="53e0" class="graf graf--li graf-after--li">made visible (which does not lock the table since 12c) when accepted</li></ul><pre name="b8b3" id="b8b3" class="graf graf--pre graf-after--li">select * from dba_auto_index_ind_actions order by action_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="93b5" id="93b5" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 85px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 8.200000000000001%;"></div><img class="graf-image" data-image-id="1*B-qL1u0uOVLDLFO5xcFiKw.png" data-width="2428" data-height="200" src="https://cdn-images-1.medium.com/max/1200/1*B-qL1u0uOVLDLFO5xcFiKw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="6a40" id="6a40" class="graf graf--p graf-after--figure">Those actions, with start/end timestamp, give more detail about the operations that we have seen in “_auto_index_log” (New index candidate, Index rebuilt, Index marked visible).</p><h3 name="fca9" id="fca9" class="graf graf--h3 graf-after--p">Automatic Indexing — SQL Statements</h3><p name="b929" id="b929" class="graf graf--p graf-after--h3">The Automatic Indexing works basically by capturing a SQL Tuning Set on which it runs the SQL Access Advisor, and the tuning set is visible as SYS_AUTO_STS (here created at the same time as my first ‘Statements in STS’ in “_auto_index_log”):</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="57c9" id="57c9" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 376px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 36.5%;"></div><img class="graf-image" data-image-id="1*rZbVWXgqo5hnmGr305eA0w.png" data-width="2436" data-height="888" src="https://cdn-images-1.medium.com/max/1200/1*rZbVWXgqo5hnmGr305eA0w.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="c034" id="c034" class="graf graf--h4 graf-after--figure">DBA_ADVISOR_OBJECTS</h4><p name="be3b" id="be3b" class="graf graf--p graf-after--h4">Automatic Indexing goes further than the SQL Access Advisor. The statements are continuously verified to detect improvement and regressions. They are stored with some flags as TYPE_ID=7 and TYPE=’SQL’</p><pre name="d93c" id="d93c" class="graf graf--pre graf-after--p">select * from dba_advisor_objects where task_name=&#39;SYS_AUTO_INDEX_TASK&#39; and type=&#39;SQL&#39; order by object_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="49d3" id="49d3" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 272px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 26.400000000000002%;"></div><img class="graf-image" data-image-id="1*vXTlwLJvgt6RCZMinsAOHA.png" data-width="2431" data-height="641" src="https://cdn-images-1.medium.com/max/1200/1*vXTlwLJvgt6RCZMinsAOHA.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="79ef" id="79ef" class="graf graf--h4 graf--startsWithDoubleQuote graf-after--figure">“_auto_index_sql_objects”</h4><p name="5ec9" id="5ec9" class="graf graf--p graf-after--h4">The internal view decodes attr2 as the Plan Hash Value and attr7 as some flags about the verification(my guess on a quick test is that flag is set to 1 when the SQL was improved, 2 when regression has been seen)</p><pre name="cf62" id="cf62" class="graf graf--pre graf-after--p">select * from sys.&quot;_auto_index_sql_objects&quot; order by object_id;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="778c" id="778c" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 255px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24.7%;"></div><img class="graf-image" data-image-id="1*EQZaymgYPtmuddCoCJZPRw.png" data-width="2430" data-height="601" src="https://cdn-images-1.medium.com/max/1200/1*EQZaymgYPtmuddCoCJZPRw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="1053" id="1053" class="graf graf--h4 graf-after--figure">DBA_AUTO_INDEX_SQL_ACTIONS</h4><p name="87e2" id="87e2" class="graf graf--p graf-after--h4">The goal of those verifications is to prevent the regressions by blacklisting the new index usage for some queries. We can see that in SQL actions:</p><pre name="9834" id="9834" class="graf graf--pre graf-after--p">select * from dba_auto_index_sql_actions;</pre></div><div class="section-inner sectionLayout--outsetColumn"><figure name="2b83" id="2b83" class="graf graf--figure graf--layoutOutsetCenter graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 86px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 8.3%;"></div><img class="graf-image" data-image-id="1*vJ0avD8iv7RzgPzbpgbIyw.png" data-width="2405" data-height="200" src="https://cdn-images-1.medium.com/max/1200/1*vJ0avD8iv7RzgPzbpgbIyw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="731e" id="731e" class="graf graf--p graf-after--figure">This is an example where Automatic Indexing has called loaded the previous plan as accepted in a SQL Plan Baseline by calling DBMS_SPM_INTERNAL.LOAD_PLANS_FROMSQL_SET</p><h4 name="5e51" id="5e51" class="graf graf--h4 graf-after--p">DBA_SQL_PLAN_BASELINES</h4><p name="dcbf" id="dcbf" class="graf graf--p graf-after--h4">This SQL Plan Baseline is identified with the ‘EVOLVE-AUTO-INDEX-LOAD’ origin.</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="533b" id="533b" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 422px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 40.9%;"></div><img class="graf-image" data-image-id="1*tsqpJWD5muay8rQMn4OizA.png" data-width="2427" data-height="993" src="https://cdn-images-1.medium.com/max/1200/1*tsqpJWD5muay8rQMn4OizA.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="cb3c" id="cb3c" class="graf graf--p graf-after--figure">This is quite surprising because fixing the previous plan does not only prevent the usage of the new AUTO index, but also any new one that I can create manually (at least until it automatically evolved).</p><h4 name="b723" id="b723" class="graf graf--h4 graf-after--p">SQL_PATCHES</h4><p name="547d" id="547d" class="graf graf--p graf-after--h4 graf--trailing">I expected to see the regressions locked down by SQL Patches rather than SQL Plan Baselines. In this first test, I see no SQL Patch created, but this is another dictionary view to look at when trying to understand Automatic Indexing.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/ea2927a9786"><time class="dt-published" datetime="2019-02-25T10:34:42.637Z">February 25, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/19c-auto-index-the-dictionary-views-ea2927a9786" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>