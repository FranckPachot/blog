<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Easy Oracle Cloud wallet location in the JDBC connection string</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Easy Oracle Cloud wallet location in the JDBC connection string</h1>
</header>
<section data-field="subtitle" class="p-summary">
I wrote about the 19c easy-connect string recently and the possibility to use a wallet with it (and no need for a tnsnames.ora then):
</section>
<section data-field="body" class="e-content">
<section name="f2e2" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="170c" id="170c" class="graf graf--h3 graf--leading graf--title">Easy Oracle Cloud wallet location in the JDBC connection string</h3><p name="3551" id="3551" class="graf graf--p graf-after--h3">I wrote about the 19c easy-connect string recently and the possibility to use a wallet with it (and no need for a tnsnames.ora then):</p><div name="bd9c" id="bd9c" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/@FranckPachot/19c-ezconnect-and-wallet-easy-connect-and-external-password-file-8e326bb8c9f5" data-href="https://medium.com/@FranckPachot/19c-ezconnect-and-wallet-easy-connect-and-external-password-file-8e326bb8c9f5" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/@FranckPachot/19c-ezconnect-and-wallet-easy-connect-and-external-password-file-8e326bb8c9f5"><strong class="markup--strong markup--mixtapeEmbed-strong">19c EZCONNECT and Wallet (Easy Connect and External Password File)</strong><br><em class="markup--em markup--mixtapeEmbed-em">I like EZCONNECT because it is simple when we know the host:port, and I like External Password Files because I hate to…</em>medium.com</a><a href="https://medium.com/@FranckPachot/19c-ezconnect-and-wallet-easy-connect-and-external-password-file-8e326bb8c9f5" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="0fd9ad5e1d1ad8c64411ba290cffa5ab" data-thumbnail-img-id="1*etjkGtmfAh7nn8W_x_h1MQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*etjkGtmfAh7nn8W_x_h1MQ.png);"></a></div><p name="e872" id="e872" class="graf graf--p graf-after--mixtapeEmbed">That was with sqlplus and setting TNS_ADMIN and still requires sqlnet.ora to set the wallet location directory. This post adds two things:</p><ul class="postList"><li name="7ddc" id="7ddc" class="graf graf--li graf-after--p">TNS_NAMES parameter in the JDBC URL with no need for <br>the java <strong class="markup--strong markup--li-strong">-Doracle.net.tns_admin</strong></li><li name="f045" id="f045" class="graf graf--li graf-after--li">We can add our password to the cloud wallet downloaded from the Autonomous Database (ATP/ADW)</li></ul><h3 name="d8bc" id="d8bc" class="graf graf--h3 graf-after--li">Oracle Cloud user</h3><p name="ee7f" id="ee7f" class="graf graf--p graf-after--h3">For this test I’ve created a new user in my Autonomous Transaction Processing cloud service.</p><figure name="1272" id="1272" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 324px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.7%;"></div><img class="graf-image" data-image-id="1*WCWqyCATTUr2uh71LrAuYg.png" data-width="1835" data-height="1133" src="https://cdn-images-1.medium.com/max/600/1*WCWqyCATTUr2uh71LrAuYg.png"></div></figure><p name="0090" id="0090" class="graf graf--p graf-after--figure">The click-path is:</p><ul class="postList"><li name="cf94" id="cf94" class="graf graf--li graf-after--p">Autonomous Database</li><li name="1809" id="1809" class="graf graf--li graf-after--li">Autonomous Database Details</li><li name="988a" id="988a" class="graf graf--li graf-after--li">Service Console</li><li name="90c9" id="90c9" class="graf graf--li graf-after--li">Administration</li><li name="7c8f" id="7c8f" class="graf graf--li graf-after--li">Manage ML Users (yes, this is the Machine Learning interface)</li><li name="ea0a" id="ea0a" class="graf graf--li graf-after--li">Create User</li></ul><p name="01ef" id="01ef" class="graf graf--p graf-after--li">I’ve created the user <em class="markup--em markup--p-em">Franck</em> with password <em class="markup--em markup--p-em">T1s1s@UserPassword</em> (with an at-sign on purpose to show you that it is annoying but manageable).</p><figure name="3771" id="3771" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 267px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 50.9%;"></div><img class="graf-image" data-image-id="1*vPjr-CL5MvoCc-pdvHmKkQ.png" data-width="1810" data-height="921" src="https://cdn-images-1.medium.com/max/600/1*vPjr-CL5MvoCc-pdvHmKkQ.png"></div></figure><p name="5d77" id="5d77" class="graf graf--p graf-after--figure">A side note here because this is the most hidden part of these autonomous services. You are in the Machine Learning interface and if you click on the Home button on top right you can log with this user and access a Zeppelin Notebook to run some SQL statements.</p><figure name="e010" id="e010" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 473px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 90.10000000000001%;"></div><img class="graf-image" data-image-id="1*4mIhDaT4E40FqV-7Og8xpw.png" data-width="842" data-height="759" data-is-featured="true" src="https://cdn-images-1.medium.com/max/600/1*4mIhDaT4E40FqV-7Og8xpw.png"></div></figure><p name="cbed" id="cbed" class="graf graf--p graf-after--figure">I’m opening one ‘SQL Script Scratchpad’ here to see my roles. Actually, a user created from this Oracle ML interface is a developer user with the role ‘OML_DEVELOPER’ and the role ‘DWROLE’ (even it this is ATP and not ADW). This differs from the ADMIN user which has many more roles.</p><p name="aada" id="aada" class="graf graf--p graf-after--p">You can create the same user from the sql command line or SQL Developer connected as ADMIN. But, for this, we need to the credentials wallet first.</p><h3 name="9e92" id="9e92" class="graf graf--h3 graf-after--p">Oracle Cloud wallet</h3><p name="96e7" id="96e7" class="graf graf--p graf-after--h3">I will connect with this user from my on-premises (aka laptop;) and then I need to download the credential wallet which contains everything I need to connect to the service remotely.</p><figure name="5a05" id="5a05" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 252px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.1%;"></div><img class="graf-image" data-image-id="1*UIWXKGqlsaC4n-Zgc095EQ.png" data-width="2638" data-height="1268" src="https://cdn-images-1.medium.com/max/600/1*UIWXKGqlsaC4n-Zgc095EQ.png"></div></figure><p name="dfba" id="dfba" class="graf graf--p graf-after--figure">The web path is:</p><ul class="postList"><li name="80c2" id="80c2" class="graf graf--li graf-after--p">Autonomous Database</li><li name="d6c3" id="d6c3" class="graf graf--li graf-after--li">Autonomous Database Details</li><li name="cbce" id="cbce" class="graf graf--li graf-after--li">Service Console</li><li name="f1bf" id="f1bf" class="graf graf--li graf-after--li">Download Client Credentials (Wallet)</li></ul><p name="e0dc" id="e0dc" class="graf graf--p graf-after--li">I enter a password for this wallet: <em class="markup--em markup--p-em">T1s1s@WalletPassword</em> and get a .zip file. This is not a password-protected ZIP. The password is the wallet password. Note that this is common to all my compartment database services and I’ll see all of them in the tnsnames.ora. There’s one wallet per compartment. Finer security is done by each database with user authentication. But the wallet has the name of the service you downloaded from</p><h3 name="d532" id="d532" class="graf graf--h3 graf-after--p">Oracle JDBC client</h3><p name="3b79" id="3b79" class="graf graf--p graf-after--h3">I unzip the wallet:</p><pre name="b93a" id="b93a" class="graf graf--pre graf-after--p">[oracle@db193]$ <strong class="markup--strong markup--pre-strong">unzip</strong> -d /home/oracle/mywallet /tmp/<strong class="markup--strong markup--pre-strong">wallet_MYATP.zip</strong><br>Archive:  /tmp/wallet_MYATP.zip<br>  inflating: /home/oracle/mywallet/cwallet.sso<br>  inflating: /home/oracle/mywallet/tnsnames.ora<br>  inflating: /home/oracle/mywallet/truststore.jks<br>  inflating: /home/oracle/mywallet/ojdbc.properties<br>  inflating: /home/oracle/mywallet/sqlnet.ora<br>  inflating: /home/oracle/mywallet/ewallet.p12<br>  inflating: /home/oracle/mywallet/keystore.jks</pre><p name="02be" id="02be" class="graf graf--p graf-after--pre">It contains 3 entries for each of my database services, with low/medium/high alternatives for resource management.</p><p name="d621" id="d621" class="graf graf--p graf-after--p">Here I’m using <em class="markup--em markup--p-em">myatp_low</em>:</p><pre name="36b9" id="36b9" class="graf graf--pre graf-after--p">[oracle@db193]$ <strong class="markup--strong markup--pre-strong">grep</strong> myatp /home/oracle/mywallet/<strong class="markup--strong markup--pre-strong">tnsnames.ora</strong><br><strong class="markup--strong markup--pre-strong">myatp_low</strong> = (description= (address=(protocol=tcps)(port=1522)(host=adb.eu-frankfurt-1.oraclecloud.com))(connect_data=(service_name=vavxrlxx2llql7m_myatp_low.atp.oraclecloud.com))(security=(ssl_server_cert_dn=&quot;CN=adwc.eucom-central-1.oraclecloud.com,OU=Oracle BMCS FRANKFURT,O=Oracle Corporation,L=Redwood City,ST=California,C=US&quot;))   )</pre><p name="3cbc" id="3cbc" class="graf graf--p graf-after--pre">If I specify only the TNS_ADMIN, the tnsnames.ora is found but not the wallet (because the directory in sqlnet.ora is not setup with the wallet location):</p><pre name="87df" id="87df" class="graf graf--pre graf-after--p">[oracle@db193]$ <strong class="markup--strong markup--pre-strong">TNS_ADMIN=</strong>/home/oracle/mywallet <strong class="markup--strong markup--pre-strong">tnsping</strong> myatp_low</pre><pre name="9ba7" id="9ba7" class="graf graf--pre graf-after--pre">TNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 08-MAY-2019 20:21:20</pre><pre name="2432" id="2432" class="graf graf--pre graf-after--pre">Copyright (c) 1997, 2019, Oracle.  All rights reserved.</pre><pre name="ba99" id="ba99" class="graf graf--pre graf-after--pre">Used parameter files:<br>/home/oracle/mywallet/sqlnet.ora</pre><pre name="9fbe" id="9fbe" class="graf graf--pre graf-after--pre">Used TNSNAMES adapter to resolve the alias<br>Attempting to contact (description= (address=(protocol=tcps)(port=1522)(host=adb.eu-frankfurt-1.oraclecloud.com))(connect_data=(service_name=vavxrlxx2llql7m_myatp_low.atp.oraclecloud.com))(security=(ssl_server_cert_dn= CN=adwc.eucom-central-1.oraclecloud.com,OU=Oracle BMCS FRANKFURT,O=Oracle Corporation,L=Redwood City,ST=California,C=US)))<br><strong class="markup--strong markup--pre-strong">TNS-12560</strong>: TNS:protocol adapter error</pre><h3 name="7eb3" id="7eb3" class="graf graf--h3 graf-after--pre">jdbc:oracle:thin:…?TNS_ADMIN=…</h3><p name="9771" id="9771" class="graf graf--p graf-after--h3">I don’t care about sqlnet.ora here and I’ll use SQLcl with the thin JDBC connection. And since 18.3 the driver supports a TNS_ADMIN parameter in the URL to mention the TNS_ADMIN. And this one is used to find the tnsnames.ora but also the credential files:</p><pre name="5cc7" id="5cc7" class="graf graf--pre graf-after--p">[oracle@db193]$ sql Franck<strong class="markup--strong markup--pre-strong">/</strong>&#39;&quot;T1s1s@UserPassword&quot;&#39;<a href="http://twitter.com/myatp_low" data-href="http://twitter.com/myatp_low" class="markup--anchor markup--pre-anchor" title="Twitter profile for @myatp_low" rel="noopener" target="_blank"><strong class="markup--strong markup--pre-strong">@</strong>myatp_low</a><strong class="markup--strong markup--pre-strong">?TNS_ADMIN=</strong>/home/oracle/mywallet</pre><pre name="3fec" id="3fec" class="graf graf--pre graf-after--pre">SQLcl: Release 19.1 Production on Wed May 08 20:23:38 2019</pre><pre name="0fe8" id="0fe8" class="graf graf--pre graf-after--pre">Copyright (c) 1982, 2019, Oracle.  All rights reserved.</pre><pre name="d0ef" id="d0ef" class="graf graf--pre graf-after--pre">Connected to:<br>Oracle Database 18c Enterprise Edition Release 18.0.0.0.0 - Production<br>Version 18.4.0.0.0</pre><pre name="4ac0" id="4ac0" class="graf graf--pre graf-after--pre">SQL&gt; show user<br>USER is &quot;FRANCK&quot;</pre><pre name="69e1" id="69e1" class="graf graf--pre graf-after--pre">SQL&gt; show jdbc-- Database Info --<br>Database Product Name: Oracle<br>Database Product Version: Oracle Database 18c Enterprise Edition Release 18.0.0.0.0 - Production<br>Version 18.4.0.0.0<br>Database Major Version: 18<br>Database Minor Version: 0<br>-- Driver Info --<br>Driver Name: Oracle JDBC driver<br>Driver Version: 19.3.0.0.0<br>Driver Major Version: 19<br>Driver Minor Version: 3<br>Driver URL: jdbc:oracle:thin:@myatp_low<br>Driver Location:<br>resource: oracle/jdbc/OracleDriver.class<br>jar: /u01/app/oracle/product/DB193/jdbc/lib/ojdbc8.jar<br>JarSize: 4210517<br>JarDate: Fri Apr 05 03:38:42 GMT 2019<br>resourceSize: 2604<br>resourceDate: Thu Apr 04 20:38:40 GMT 2019</pre><p name="2db7" id="2db7" class="graf graf--p graf-after--pre">This is awesome because in previous JDBC driver versions you had to set this by adding a parameter in Java, like -Doracle.net.tns_admin or OracleConnection.CONNECTION_PROPERTY_TNS_ADMIN (or SET CLOUDCONFIG in SQLcl).</p><p name="e152" id="e152" class="graf graf--p graf-after--p">The 18.3 version of the driver is available for JDK 8 (ojdbc8.jar) and JDK 10 (ojdbc10.jar):</p><div name="fb4a" id="fb4a" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.oracle.com/technetwork/database/application-development/jdbc/downloads/index.html" data-href="https://www.oracle.com/technetwork/database/application-development/jdbc/downloads/index.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.oracle.com/technetwork/database/application-development/jdbc/downloads/index.html"><strong class="markup--strong markup--mixtapeEmbed-strong">JDBC and UCP Downloads page</strong><br><em class="markup--em markup--mixtapeEmbed-em">This page lists JDBC driver , UCP and other necessary jar files for various supported versions of Oracle Database.</em>www.oracle.com</a><a href="https://www.oracle.com/technetwork/database/application-development/jdbc/downloads/index.html" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="5f4ab91f8b8ca6d04a229bcf79ec6ae4" data-thumbnail-img-id="0*kESvtzOSG3kl1dy8" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*kESvtzOSG3kl1dy8);"></a></div><p name="52c5" id="52c5" class="graf graf--p graf-after--mixtapeEmbed">Note: it seems that JDBC does not understand comma separated tnsnames.ora entries (convenient, but maybe not documented).</p><h3 name="8b0d" id="8b0d" class="graf graf--h3 graf-after--p">Passwordless connection</h3><p name="03a2" id="03a2" class="graf graf--p graf-after--h3">And there is more. You have an easy way to set the wallet location. You have a wallet. It is used to store the SSL/TLS certificate and key.</p><p name="286a" id="286a" class="graf graf--p graf-after--p">But you can use the same to store your passwords:</p><pre name="9746" id="9746" class="graf graf--pre graf-after--p">[oracle@db193]$ mkstore -wrl . -createCredential myatp_low Franck<br>Oracle Secret Store Tool Release 19.0.0.0.0 - Production<br>Version 19.3.0.0.0<br>Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.</pre><pre name="79b6" id="79b6" class="graf graf--pre graf-after--pre">Your secret/Password is missing in the command line<br>Enter your secret/Password: T1s1s@UserPassword<br>Re-enter your secret/Password: T1s1s@UserPassword<br>Enter wallet password:</pre><p name="9493" id="9493" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Important note:</strong> this is easy for passwordless connection, but then the protection of those files are critical. Before, you needed the wallet and the user password to connect to your service. The wallet to reach the database, and the user password to connect to it. Now, anybody that has read access to the wallet can connect to your service with the stored credentials.</p><p name="a31c" id="a31c" class="graf graf--p graf-after--p">Here is the list of credentials stored there:</p><pre name="2c41" id="2c41" class="graf graf--pre graf-after--p">[oracle@db193]$ <strong class="markup--strong markup--pre-strong">mkstore</strong> -wrl . <strong class="markup--strong markup--pre-strong">-listCredential</strong><br>Oracle Secret Store Tool Release 19.0.0.0.0 - Production<br>Version 19.3.0.0.0<br>Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.</pre><pre name="aeee" id="aeee" class="graf graf--pre graf-after--pre">Enter wallet password: T1s1s@WalletPassword<br>List credential (index: connect_string username)<br>1: myatp_low Franck</pre><p name="c535" id="c535" class="graf graf--p graf-after--pre">And even the stored password is easily visible when you provide the wallet password:</p><pre name="def3" id="def3" class="graf graf--pre graf-after--p">[oracle@db193]$ mkstore -wrl . -viewEntry oracle.security.client.password1<br>Oracle Secret Store Tool Release 19.0.0.0.0 - Production<br>Version 19.3.0.0.0<br>Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.</pre><pre name="1d06" id="1d06" class="graf graf--pre graf-after--pre">Enter wallet password: T1s1s@WalletPassword<br>oracle.security.client.password1 = T1s1s@UserPassword</pre><p name="873e" id="873e" class="graf graf--p graf-after--pre">There’s no magic. This is still password authentication and the passwords needs to be read. But that’s better than having it hardcoded in scripts and command lines.</p><p name="fba0" id="fba0" class="graf graf--p graf-after--p">So, now it is easy to connect without mentioning the user and password but only the service and the location of the wallet:</p><pre name="07a7" id="07a7" class="graf graf--pre graf-after--p">[oracle@db193]$ sql <strong class="markup--strong markup--pre-strong">/@</strong>myatp_low<strong class="markup--strong markup--pre-strong">?TNS_ADMIN=</strong>/home/oracle/mywallet</pre><pre name="765c" id="765c" class="graf graf--pre graf-after--pre">SQLcl: Release 19.1 Production on Wed May 08 20:27:25 2019</pre><pre name="8e4a" id="8e4a" class="graf graf--pre graf-after--pre">Copyright (c) 1982, 2019, Oracle.  All rights reserved.</pre><pre name="3ba0" id="3ba0" class="graf graf--pre graf-after--pre">Connected to:<br>Oracle Database 18c Enterprise Edition Release 18.0.0.0.0 - Production<br>Version 18.4.0.0.0</pre><pre name="ab55" id="ab55" class="graf graf--pre graf-after--pre">SQL&gt; show user<br>USER is &quot;FRANCK&quot;<br>SQL&gt;</pre><p name="2175" id="2175" class="graf graf--p graf-after--pre graf--trailing">the service has been found in the tnsnames.ora and the password in the credentials (sqlnet.ora was not used there, so no need to configure it).</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/c782d2011252"><time class="dt-published" datetime="2019-05-10T06:23:39.307Z">May 10, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/easy-oracle-cloud-wallet-location-in-the-jdbc-connection-string-c782d2011252" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>