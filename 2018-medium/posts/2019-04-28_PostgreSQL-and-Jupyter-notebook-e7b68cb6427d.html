<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>PostgreSQL and Jupyter notebook</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">PostgreSQL and Jupyter notebook</h1>
</header>
<section data-field="subtitle" class="p-summary">
Here is a little test of Jupyter Notebook to access a PostgreSQL database with very simple installation, thanks to Anaconda. I did it on…
</section>
<section data-field="body" class="e-content">
<section name="31af" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="19b7" id="19b7" class="graf graf--h3 graf--leading graf--title">PostgreSQL and Jupyter notebook</h3><p name="1efb" id="1efb" class="graf graf--p graf-after--h3">Here is a little test of Jupyter Notebook to access a PostgreSQL database with very simple installation, thanks to Anaconda. I did it on Windows 10 but the same simplicity is on Linux and Mac.</p><h3 name="951f" id="951f" class="graf graf--h3 graf-after--p">Anaconda</h3><p name="9c4f" id="9c4f" class="graf graf--p graf-after--h3">I’ll use Anaconda to install the required components</p><blockquote name="566d" id="566d" class="graf graf--blockquote graf-after--p">Conda is an open source package management system and environment management system that runs on Windows, macOS and Linux. Conda quickly installs, runs and updates packages and their dependencies.</blockquote><figure name="c910" id="c910" class="graf graf--figure graf--layoutOutsetLeft graf-after--blockquote"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 282px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 53.7%;"></div><img class="graf-image" data-image-id="1*yj2i3bZJQpIevCyukFQhKQ.png" data-width="918" data-height="493" src="https://cdn-images-1.medium.com/max/600/1*yj2i3bZJQpIevCyukFQhKQ.png"></div><figcaption class="imageCaption"><a href="https://www.anaconda.com/distribution/#download-section" data-href="https://www.anaconda.com/distribution/#download-section" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">https://www.anaconda.com/distribution/#download-section</a></figcaption></figure><h4 name="6a92" id="6a92" class="graf graf--h4 graf-after--figure">Installation</h4><p name="08d5" id="08d5" class="graf graf--p graf-after--h4">The install is very easy — just go to <a href="https://www.anaconda.com/distribution/#download-section" data-href="https://www.anaconda.com/distribution/#download-section" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://www.anaconda.com/</a> and download for your environment. Then, manage everything from the Anaconda Navigator. I choose the Python3 64-bit version for Windows.</p><p name="4d4c" id="4d4c" class="graf graf--p graf-after--p">I used all defaults, the installation directory being in the %USERPROFILE% home directory (like C:\Users\Franck\Anaconda3).</p><figure name="82c7" id="82c7" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 314px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 59.8%;"></div><img class="graf-image" data-image-id="1*5tvvIJJVRPvoK4Kr9CvEZw.png" data-width="630" data-height="377" src="https://cdn-images-1.medium.com/max/600/1*5tvvIJJVRPvoK4Kr9CvEZw.png"></div></figure><p name="e4a1" id="e4a1" class="graf graf--p graf-after--figure">This installs a few shortcuts in the Start Menu, such as the Anaconda Prompt (the command line where you can run conda, with all environment set) in CMD and PowerShell version, or the Jupyter notebook.</p><p name="ce7d" id="ce7d" class="graf graf--p graf-after--p">You can run everything from the <strong class="markup--strong markup--p-strong">Anaconda Navigator</strong>, for example, get the command line with all the environment set:</p><figure name="14c7" id="14c7" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 356px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 50.8%;"></div><img class="graf-image" data-image-id="1*erqa8F0ZTdxTjW3RUTanlw.png" data-width="1411" data-height="717" src="https://cdn-images-1.medium.com/max/800/1*erqa8F0ZTdxTjW3RUTanlw.png"></div></figure><p name="f3bc" id="f3bc" class="graf graf--p graf-after--figure">Or you can simply run the Anaconda Prompt in the Start Menu which is a shortcut for:</p><pre name="0706" id="0706" class="graf graf--pre graf-after--p">%windir%\System32\cmd.exe &quot;/K&quot; C:\Users\Franck\Anaconda3\Scripts\activate.bat C:\Users\Franck\Anaconda3</pre><p name="76dc" id="76dc" class="graf graf--p graf-after--pre">Now, from this prompt, I’ll install a few additional packages</p><h3 name="693d" id="693d" class="graf graf--h3 graf-after--p">IPython SQL</h3><blockquote name="768e" id="768e" class="graf graf--blockquote graf-after--h3">ipython-sql introduces a %sql (or %%sql) magic to your notebook allowing you to connect to a database, using SQLAlchemy connect strings, then issue SQL commands within IPython or IPython Notebook.</blockquote><div name="fdf0" id="fdf0" class="graf graf--mixtapeEmbed graf-after--blockquote"><a href="https://github.com/catherinedevlin/ipython-sql" data-href="https://github.com/catherinedevlin/ipython-sql" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/catherinedevlin/ipython-sql"><strong class="markup--strong markup--mixtapeEmbed-strong">catherinedevlin/ipython-sql</strong><br><em class="markup--em markup--mixtapeEmbed-em">sql magic for IPython, hopefully evolving into full SQL client - catherinedevlin/ipython-sql</em>github.com</a><a href="https://github.com/catherinedevlin/ipython-sql" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="39a42326f48ea2c408943cdcf182f516" data-thumbnail-img-id="0*vmLXC56NPND4FgJt" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*vmLXC56NPND4FgJt);"></a></div><p name="b3da" id="b3da" class="graf graf--p graf-after--mixtapeEmbed">Here is how to install it from the Anaconda Prompt:</p><pre name="f539" id="f539" class="graf graf--pre graf-after--p">conda install -y -c conda-forge ipython-sql</pre><h3 name="8a78" id="8a78" class="graf graf--h3 graf-after--pre">PostgreSQL</h3><p name="5b65" id="5b65" class="graf graf--p graf-after--h3">I’ll run the postgres server directly in this environment:</p><pre name="c078" id="c078" class="graf graf--pre graf-after--p">conda install -y -c conda-forge postgresql</pre><p name="e8f1" id="e8f1" class="graf graf--p graf-after--pre">The link between ipython-sql and the postgresql API is done by psycopg2:</p><blockquote name="c8c1" id="c8c1" class="graf graf--blockquote graf-after--p">Psycopg is the most popular PostgreSQL adapter for the Python programming language. Its main features are the complete implementation of the Python DB API 2.0 specification and the thread safety.</blockquote><pre name="a848" id="a848" class="graf graf--pre graf-after--blockquote">conda install -y -c anaconda psycopg2</pre><p name="6d52" id="6d52" class="graf graf--p graf-after--pre">I also install Pgspecial to run the ‘backslash’ commands like in psql</p><pre name="661d" id="661d" class="graf graf--pre graf-after--p">conda install -y -c conda-forge pgspecial</pre><h4 name="98dd" id="98dd" class="graf graf--h4 graf-after--pre">Create a database</h4><p name="516b" id="516b" class="graf graf--p graf-after--h4">From the Anaconda Prompt, I create my PostgreSQL database in C:\Anaconda\pgdata:</p><pre name="2e70" id="2e70" class="graf graf--pre graf-after--p">set PGDATA=C:\Anaconda\pgdata<br>mkdir %PGDATA%<br>pg_ctl initdb<br>pg_ctl start<br>psql -c &quot;create database DEMO;&quot; postgres</pre><p name="90cf" id="90cf" class="graf graf--p graf-after--pre">I’m now ready to run some SQL from the Jupyter notebook and do not need the Anaconda Prompt anymore (I can run shell commands from a notebook).</p><h3 name="f392" id="f392" class="graf graf--h3 graf-after--p">Jupyter Notebook</h3><figure name="3f04" id="3f04" class="graf graf--figure graf--layoutOutsetLeft graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 276px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52.6%;"></div><img class="graf-image" data-image-id="1*XDRozJr0_TRs85ST3eXm5g.png" data-width="2047" data-height="1076" data-is-featured="true" src="https://cdn-images-1.medium.com/max/600/1*XDRozJr0_TRs85ST3eXm5g.png"></div></figure><p name="f242" id="f242" class="graf graf--p graf-after--figure">I can start Jupyter from the Anaconda Navigator, but it defaults to the %USERPROFILE% directory.</p><p name="269a" id="269a" class="graf graf--p graf-after--p">I prefer to change the Jupyter Notebook shortcut (right-click-more-open file location-properties) to replace USERPROFILE with my C:\Anaconda directory which will be where I’ll create notebooks:</p><pre name="488c" id="488c" class="graf graf--pre graf-after--p">C:\Users\Franck\Anaconda3\python.exe C:\Users\Franck\Anaconda3\cwp.py C:\Users\Franck\Anaconda3 C:\Users\Franck\Anaconda3\python.exe C:\Users\Franck\Anaconda3\Scripts\jupyter-notebook-script.py &quot;C:\Anaconda/&quot;</pre><p name="95c7" id="95c7" class="graf graf--p graf-after--pre">Or simply run it from the Anaconda Prompt:</p><pre name="d87f" id="d87f" class="graf graf--pre graf-after--p">jupyter.exe notebook --notebook-dir=C:\Anaconda</pre><p name="e5bd" id="e5bd" class="graf graf--p graf-after--pre">This runs Jupyter and opens it in my browser. I create a new notebook with New-Python3:</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="0ce4" id="0ce4" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 322px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.2%;"></div><img class="graf-image" data-image-id="1*LrM2RopzCjiE5M0eylUL7A.png" data-width="2732" data-height="852" src="https://cdn-images-1.medium.com/max/1200/1*LrM2RopzCjiE5M0eylUL7A.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="2ce3" id="2ce3" class="graf graf--p graf-after--figure">I load the iPython SQL extension:</p><pre name="43ce" id="43ce" class="graf graf--pre graf-after--p">%load_ext sql</pre><p name="6af1" id="6af1" class="graf graf--p graf-after--pre">connect to the DEMO database</p><pre name="bc3c" id="bc3c" class="graf graf--pre graf-after--p">%sql postgresql://localhost/demo</pre><p name="5c5d" id="5c5d" class="graf graf--p graf-after--pre">and I can run some SQL statements, like:</p><pre name="3575" id="3575" class="graf graf--pre graf-after--p">%sql select version()</pre><p name="a4d3" id="a4d3" class="graf graf--p graf-after--pre">But I’ll not put more commands in this blog post, because that’s the main advantage of a Jupyter Notebook: show the commands, the output, and some comments.</p><h3 name="2ff4" id="2ff4" class="graf graf--h3 graf-after--p">GitHub Gist and Medium</h3><p name="0db3" id="0db3" class="graf graf--p graf-after--h3">I’ve uploaded my notebook on GitHub Gist for easy sharing: <a href="https://gist.github.com/FranckPachot/31fd2450506a60ae8698b066e0876de9" data-href="https://gist.github.com/FranckPachot/31fd2450506a60ae8698b066e0876de9" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Blog20190428-postgresql-and-jupyter-notebook-on-windows.ipynb</a></p><p name="12e0" id="12e0" class="graf graf--p graf-after--p">GitHub display it correctly, and you can download it to test on your environment. And Medium seems to embed it in a very way:</p><figure name="9aa8" id="9aa8" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/FranckPachot/31fd2450506a60ae8698b066e0876de9.js"></script><figcaption class="imageCaption"><a href="https://gist.github.com/FranckPachot/31fd2450506a60ae8698b066e0876de9" data-href="https://gist.github.com/FranckPachot/31fd2450506a60ae8698b066e0876de9" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">https://gist.github.com/FranckPachot/31fd2450506a60ae8698b066e0876de9</a></figcaption></figure><p name="7d69" id="7d69" class="graf graf--p graf-after--figure graf--trailing">🤔 Now thinking about it, most of my blog posts contain some code, some output, and titles and comments around them… And I try to build the examples with scripts that can be re-run easily. That’s exactly the goal of the notebook, without the risk of copy/paste error and easy to re-run on a newer version. I’ll try this idea but don’t worry, I’ll link from Medium so continue to follow here and comment on <a href="https://twitter.com/FranckPachot" data-href="https://twitter.com/FranckPachot" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Twitter</a>.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/e7b68cb6427d"><time class="dt-published" datetime="2019-04-28T18:25:51.294Z">April 28, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/postgresql-and-jupyter-notebook-e7b68cb6427d" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>