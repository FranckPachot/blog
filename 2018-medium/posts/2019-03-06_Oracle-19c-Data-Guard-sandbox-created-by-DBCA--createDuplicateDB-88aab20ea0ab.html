<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Oracle 19c Data Guard sandbox created by DBCA -createDuplicateDB</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Oracle 19c Data Guard sandbox created by DBCA -createDuplicateDB</h1>
</header>
<section data-field="subtitle" class="p-summary">
Here are the commands I use to create a sandbox on Linux with a CDB1 database in a Data Guard configuration. I use the latest (19c) DBCA…
</section>
<section data-field="body" class="e-content">
<section name="430f" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="420d" id="420d" class="graf graf--h3 graf--leading graf--title">Oracle 19c Data Guard sandbox created by DBCA -<strong class="markup--strong markup--h3-strong">createDuplicateDB</strong></h3><p name="e630" id="e630" class="graf graf--p graf-after--h3">Here are the commands I use to create a sandbox on Linux with a CDB1 database in a Data Guard configuration. I use the latest (19c) DBCA features to create the Primary and duplicate to the Standby.</p><figure name="b665" id="b665" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 349px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 66.5%;"></div><img class="graf-image" data-image-id="1*HwdxpVnUA-C7mNT6yAjqRw.png" data-width="741" data-height="493" data-is-featured="true" src="https://cdn-images-1.medium.com/max/600/1*HwdxpVnUA-C7mNT6yAjqRw.png"></div></figure><p name="0ac0" id="0ac0" class="graf graf--p graf-after--figure">I’m doing all in a VM which is a Compute Instance provisioned in the Oracle Cloud. In this example, I have an Oracle Linux 7.6 VM.DenseIO2.24 shape with 320GB RAM and 24 cores but remember that you will not be able to scale up/down so choose according to your credits...</p><p name="26ea" id="26ea" class="graf graf--p graf-after--p">I have 40GB in the / filesystem</p><h4 name="f6d8" id="f6d8" class="graf graf--h4 graf-after--p">OS and filesystem installation</h4><p name="70c7" id="70c7" class="graf graf--p graf-after--h4">I’ve installed the prerequisites as root (preinstall package, sudo and HugePages — here 200GB out of the 314GB I have):</p><pre name="fa94" id="fa94" class="graf graf--pre graf-after--p">sudo su<br>yum -y update<br>yum -y install -y oracle-database-preinstall-18c</pre><pre name="c57f" id="c57f" class="graf graf--pre graf-after--pre">grep &quot;oracle&quot; /etc/sudoers || echo &quot;oracle  ALL=(ALL)       NOPASSWD: ALL&quot; &gt;&gt; /etc/sudoers</pre><pre name="20d9" id="20d9" class="graf graf--pre graf-after--pre">echo &quot;vm.nr_hugepages=<strong class="markup--strong markup--pre-strong">102400</strong>&quot; &gt;&gt; /etc/sysctl.conf<br>sysctl -p</pre><p name="96c5" id="96c5" class="graf graf--p graf-after--pre">I’ve attached a 8TB block device:</p><figure name="ae6a" id="ae6a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 169px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24.2%;"></div><img class="graf-image" data-image-id="1*k5dCWlmNrY_sRy9tmtiUtA.png" data-width="1307" data-height="316" src="https://cdn-images-1.medium.com/max/800/1*k5dCWlmNrY_sRy9tmtiUtA.png"></div></figure><p name="abeb" id="abeb" class="graf graf--p graf-after--figure">I create a /u01 filesystem on it for my Oracle installation</p><pre name="e344" id="e344" class="graf graf--pre graf-after--p">sudo iscsiadm -m node -o new -T iqn.2015-12.com.oracleiaas:a9a2...<br>sudo iscsiadm -m node -o update -T iqn.2015-12.com.oracleiaas:a91...<br>sudo iscsiadm -m node -T iqn.2015-12.com.oracleiaas:a9a21f4...</pre><pre name="8944" id="8944" class="graf graf--pre graf-after--pre">mkfs.xfs /dev/oracleoci/oraclevdb<br>mkdir /u01<br>mount /dev/oracleoci/oraclevdb /u01<br>echo &quot;/dev/oracleoci/oraclevdb /u01 xfs defaults,_netdev,nofail 0 0&quot; &gt;&gt; /etc/fstab<br>mkdir -p /u01/app/oracle/product/DB192<br>chown -R oracle:dba /u01</pre><h4 name="471f" id="471f" class="graf graf--h4 graf-after--pre">Oracle software</h4><p name="8761" id="8761" class="graf graf--p graf-after--h4">First, I install the Oracle Home (unzip <a href="https://edelivery.oracle.com/osdc/faces/SoftwareDelivery" data-href="https://edelivery.oracle.com/osdc/faces/SoftwareDelivery" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">V981623–01.zip</a> in /u01/app/oracle/product/DB192 and run runInstaller).</p><pre name="bbb2" id="bbb2" class="graf graf--pre graf-after--p">su - oracle</pre><pre name="ddac" id="ddac" class="graf graf--pre graf-after--pre">mkdir -p <strong class="markup--strong markup--pre-strong">/u01</strong>/oradata <strong class="markup--strong markup--pre-strong">/u01</strong>/fast_recovery_area <strong class="markup--strong markup--pre-strong">/u01</strong>/app/oracle<br>unzip -d <strong class="markup--strong markup--pre-strong">/u01/app/oracle/product/DB192</strong> <strong class="markup--strong markup--pre-strong">V981623-01.zip</strong></pre><pre name="cf74" id="cf74" class="graf graf--pre graf-after--pre">cat &gt; <strong class="markup--strong markup--pre-strong">/u01</strong>/oradata/DB192.rsp &lt;&lt;END<br>oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v19.0.0<br>oracle.install.option=INSTALL_DB_SWONLY<br>UNIX_GROUP_NAME=oinstall<br>INVENTORY_LOCATION=/u01/app/oraInventory<br>ORACLE_BASE=/u01/app/oracle<br>ORACLE_HOME=/u01/app/oracle/product/DB192<br>oracle.install.db.InstallEdition=<strong class="markup--strong markup--pre-strong">EE</strong><br>oracle.install.db.OSDBA_GROUP=dba<br>oracle.install.db.OSOPER_GROUP=oper<br>oracle.install.db.OSBACKUPDBA_GROUP=backupdba<br>oracle.install.db.OSDGDBA_GROUP=dgdba<br>oracle.install.db.OSKMDBA_GROUP=kmdba<br>oracle.install.db.OSRACDBA_GROUP=dba<br>oracle.install.db.rootconfig.executeRootScript=true<br>oracle.install.db.rootconfig.configMethod=SUDO<br>oracle.install.db.rootconfig.sudoPath=/bin/sudo<br>oracle.install.db.rootconfig.sudoUserName=oracle<br>END</pre><pre name="da6d" id="da6d" class="graf graf--pre graf-after--pre">/u01/app/oracle/product/DB192/<strong class="markup--strong markup--pre-strong">runInstaller -silent</strong> \<br> <strong class="markup--strong markup--pre-strong">-responseFile</strong> /u01/oradata/DB192.rsp</pre><p name="7d2d" id="7d2d" class="graf graf--p graf-after--pre">You may see that sudo is not accepted without entering the oracle password, so just in case, you can run it manually:</p><pre name="efe0" id="efe0" class="graf graf--pre graf-after--p">sudo /u01/app/oracle/product/DB192/root.sh</pre><h4 name="31c0" id="31c0" class="graf graf--h4 graf-after--pre">Create the databases</h4><p name="1652" id="1652" class="graf graf--p graf-after--h4">I add a ‘#’ in front of the text for easy copy/paste of the whole setup.</p><p name="fd8b" id="fd8b" class="graf graf--p graf-after--p"># Set the environment and create the directories</p><pre name="290f" id="290f" class="graf graf--pre graf-after--p">ORACLE_HOME=<strong class="markup--strong markup--pre-strong">/u01/app/oracle/product/DB192</strong><br>mkdir -p <strong class="markup--strong markup--pre-strong">/u01</strong>/oradata <strong class="markup--strong markup--pre-strong">/u01</strong>/fast_recovery_area</pre><p name="8170" id="8170" class="graf graf--p graf-after--pre"># Divide the huge pages to fit equally 4 instances</p><pre name="b107" id="b107" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">SGA_MB</strong>=$(awk &#39;/Hugepagesize.*kB/{s=$2} /HugePages_Total/ {f=$2} END{print s*f/1024<strong class="markup--strong markup--pre-strong">/4</strong>} &#39; /proc/meminfo)</pre><p name="b81f" id="b81f" class="graf graf--p graf-after--pre"># Here is a script to create the standby logs after the creation of the primary database as this is not done by DBCA (one more than online redo logs and no multiplexing). Mention the tread# or you will have some unexpected warnings with validate database.</p><pre name="5712" id="5712" class="graf graf--pre graf-after--p">cat &gt; <strong class="markup--strong markup--pre-strong">/u01</strong>/oradata/add_standby_log.sql &lt;&lt;&#39;SQL&#39;<br>exec for i in (select t,g+rownum g,s from (select thread# t,max(bytes) s,count(*)+1 c from v$log group by thread#),(select rownum n from xmltable(&#39;1 to 100&#39;)),(select max(group#) g from v$log) where n&lt;=c) loop execute immediate &#39;<strong class="markup--strong markup--pre-strong">alter database add standby logfile thread </strong>&#39;||i.t||&#39; <strong class="markup--strong markup--pre-strong">group</strong> &#39;||i.g||&#39; <strong class="markup--strong markup--pre-strong">size</strong> &#39;||i.s; end loop;<br>exit<br>SQL</pre><p name="ebbc" id="ebbc" class="graf graf--p graf-after--pre"># Primary database creation</p><pre name="d0fd" id="d0fd" class="graf graf--pre graf-after--p">grep ^<strong class="markup--strong markup--pre-strong">CDB1A</strong>: /etc/oratab || $ORACLE_HOME/bin/dbca -silent \<br> -createDatabase -gdbName <strong class="markup--strong markup--pre-strong">CDB1 </strong>-sid <strong class="markup--strong markup--pre-strong">CDB1A</strong> \<br> -createAsContainerDatabase true -numberOfPdbs 1 -pdbName <strong class="markup--strong markup--pre-strong">PDB1 </strong>\<br> -sysPassword <strong class="markup--strong markup--pre-strong">oracle </strong>-systemPassword <strong class="markup--strong markup--pre-strong">oracle</strong> \<br> -pdbAdminPassword <strong class="markup--strong markup--pre-strong">oracle </strong>\<br> -datafileDestination <strong class="markup--strong markup--pre-strong">/u01</strong>/oradata -useOMF true -storageType FS \<br> -recoveryAreaDestination <strong class="markup--strong markup--pre-strong">/u01</strong>/fast_recovery_area \<br> -recoveryAreaSize <strong class="markup--strong markup--pre-strong">10240 </strong>-enableArchive true \<br> -memoryMgmtType AUTO_SGA -totalMemory ${SGA_MB:=4096} \<br> -createListener <strong class="markup--strong markup--pre-strong">LISTENER1A:1521</strong> \<br> -emConfiguration EMEXPRESS -emExpressPort <strong class="markup--strong markup--pre-strong">5501 </strong>\<br> -templateName General_Purpose.dbc \<br> -databaseType OLTP -sampleSchema true -redoLogFileSize 100 \<br> -customScripts <strong class="markup--strong markup--pre-strong">/u01</strong>/oradata/add_standby_log.sql \<br> -initParams \<br>db_unique_name=<strong class="markup--strong markup--pre-strong">CDB1A</strong>,dg_broker_start=true,shared_pool_size=<strong class="markup--strong markup--pre-strong">600M</strong></pre><p name="3c14" id="3c14" class="graf graf--p graf-after--pre"># Database duplication for the standby — this is possible from DBCA in 19c:</p><pre name="f44f" id="f44f" class="graf graf--pre graf-after--p">grep ^<strong class="markup--strong markup--pre-strong">CDB1B</strong>: /etc/oratab || $ORACLE_HOME/bin/dbca -silent \<br> -<strong class="markup--strong markup--pre-strong">createDuplicateDB</strong> -gdbName <strong class="markup--strong markup--pre-strong">CDB1 </strong>-sid <strong class="markup--strong markup--pre-strong">CDB1B </strong>\<br> -<strong class="markup--strong markup--pre-strong">createAsStandby</strong> -dbUniqueName <strong class="markup--strong markup--pre-strong">CDB1B </strong>-sysPassword <strong class="markup--strong markup--pre-strong">oracle</strong> \<strong class="markup--strong markup--pre-strong"><br> </strong>-primaryDBConnectionString $(hostname):<strong class="markup--strong markup--pre-strong">1521</strong>/<strong class="markup--strong markup--pre-strong">CDB1A \<br> </strong>-datafileDestination /u01/oradata -useOMF true -storageType FS \<br> -recoveryAreaDestination /u01/fast_recovery_area \<br> -recoveryAreaSize <strong class="markup--strong markup--pre-strong">10240</strong> -enableArchive true \<br> -createListener <strong class="markup--strong markup--pre-strong">LISTENER1B</strong>:<strong class="markup--strong markup--pre-strong">1522</strong></pre><p name="0428" id="0428" class="graf graf--p graf-after--pre"># fix local listener (I see no reason to resolve it in tnsnames.ora and anyway DBCA fails to update it correctly). Note that, being on the same host, I need two listeners because the same services (the PDB names) are registered by both instances.</p><pre name="9272" id="9272" class="graf graf--pre graf-after--p">. oraenv &lt;&lt;&lt; CDB1A<br>ORACLE_SID=CDB1A sqlplus / as sysdba &lt;&lt;&lt;&quot;alter system set local_listener=&#39;//$(hostname):<strong class="markup--strong markup--pre-strong">1521</strong>&#39;;&quot;<br>ORACLE_SID=CDB1B sqlplus / as sysdba &lt;&lt;&lt;&quot;alter system set local_listener=&#39;//$(hostname):<strong class="markup--strong markup--pre-strong">1522</strong>&#39;;&quot;</pre><p name="f270" id="f270" class="graf graf--p graf-after--pre"># Enable flashback (I’ll use FSFO)</p><pre name="ee59" id="ee59" class="graf graf--pre graf-after--p">for i in CDB1{B,A} ; do ORACLE_SID=$i rman target / &lt;&lt;&lt;&#39;alter database flashback on;&#39; ; done<br><br></pre><p name="e32d" id="e32d" class="graf graf--p graf-after--pre"># Create a CDB1 service for the primary</p><pre name="ba88" id="ba88" class="graf graf--pre graf-after--p">ORACLE_SID=CDB1A sqlplus / as sysdba &lt;&lt;&#39;SQL&#39;<br>exec dbms_service.create_service(service_name=&gt;&#39;CDB1&#39;,network_name=&gt;&#39;CDB1&#39;); dbms_service.start_service(service_name=&gt;&#39;CDB1&#39;);<br>create or replace trigger start_role_services<br>  after db_role_change on database<br>begin<br>  for i in (select database_role, open_mode from v$database) loop<br>  if i.database_role=&#39;PRIMARY&#39; then dbms_service.start_service(&#39;CDB1&#39;); else dbms_service.start_service(&#39;CDB1&#39;); end if;<br>  end loop;<br>end;<br>/<br>show errors<br>SQL</pre><p name="3b32" id="3b32" class="graf graf--p graf-after--pre"># Listener static entries (I remove first the SID_LIST added by DBCA)</p><pre name="826f" id="826f" class="graf graf--pre graf-after--p">sed -ie &#39;/^SID_LIST/,$d&#39; $ORACLE_HOME/network/admin/listener.ora</pre><pre name="5725" id="5725" class="graf graf--pre graf-after--pre">cat &gt;&gt;$ORACLE_HOME/network/admin/listener.ora &lt;&lt;CAT<br>SID_LIST_<strong class="markup--strong markup--pre-strong">LISTENER1A</strong>=(SID_LIST=(SID_DESC=(GLOBAL_DBNAME=<strong class="markup--strong markup--pre-strong">CDB1A</strong>_DGMGRL)(SID_NAME=<strong class="markup--strong markup--pre-strong">CDB1A</strong>)(ORACLE_HOME=$ORACLE_HOME)))<br>SID_LIST_<strong class="markup--strong markup--pre-strong">LISTENER1B</strong>=(SID_LIST=(SID_DESC=(GLOBAL_DBNAME=<strong class="markup--strong markup--pre-strong">CDB1B</strong>_DGMGRL)(SID_NAME=<strong class="markup--strong markup--pre-strong">CDB1B</strong>)(ORACLE_HOME=$ORACLE_HOME)))<br>CAT</pre><pre name="5d9a" id="5d9a" class="graf graf--pre graf-after--pre">for i in {1521..1522} ; do lsnrctl reload //$(hostname):$i ; done</pre><p name="f7fe" id="f7fe" class="graf graf--p graf-after--pre"># A minimal Data Guard Broker configuration that allows FSFO</p><pre name="346b" id="346b" class="graf graf--pre graf-after--p">cat &gt; <strong class="markup--strong markup--pre-strong">/u01</strong>/oradata/configure_dgb.sql &lt;&lt;DGB</pre><pre name="2cf7" id="2cf7" class="graf graf--pre graf-after--pre">create configuration <strong class="markup--strong markup--pre-strong">CDB1 </strong>as primary database is <strong class="markup--strong markup--pre-strong">CDB1A </strong>connect identifier is &#39;//$(hostname):<strong class="markup--strong markup--pre-strong">1521</strong>/<strong class="markup--strong markup--pre-strong">CDB1A_DGMGRL</strong>&#39;;</pre><pre name="3af7" id="3af7" class="graf graf--pre graf-after--pre">add database <strong class="markup--strong markup--pre-strong">CDB1B </strong>as connect identifier is &#39;//$(hostname):<strong class="markup--strong markup--pre-strong">1522</strong>/<strong class="markup--strong markup--pre-strong">CDB1B_DGMGRL</strong>&#39;;</pre><pre name="4f91" id="4f91" class="graf graf--pre graf-after--pre">edit database <strong class="markup--strong markup--pre-strong">CDB1A </strong>set property LogXptMode=&#39;SYNC&#39;;<br>edit database <strong class="markup--strong markup--pre-strong">CDB1B </strong>set property LogXptMode=&#39;SYNC&#39;;<br>enable configuration;<br>edit database <strong class="markup--strong markup--pre-strong">CDB1A </strong>set property StandbyFileManagement=&#39;AUTO&#39;;<br>edit database <strong class="markup--strong markup--pre-strong">CDB1B </strong>set property StandbyFileManagement=&#39;AUTO&#39;;<br>edit database <strong class="markup--strong markup--pre-strong">CDB1B </strong>set property FastStartFailoverTarget=&#39;CDB1A&#39;;<br>edit database <strong class="markup--strong markup--pre-strong">CDB1A </strong>set property FastStartFailoverTarget=&#39;CDB1B&#39;;<br>edit configuration set protection mode as MaxAvailability;<br>enable fast_start failover observe only;<br>DGB</pre><pre name="c8e0" id="c8e0" class="graf graf--pre graf-after--pre">dgmgrl sys/oracle &lt;<strong class="markup--strong markup--pre-strong">/u01</strong>/oradata/configure_dgb.sql</pre><p name="7759" id="7759" class="graf graf--p graf-after--pre"># Set ‘Y’ in oratab for dbstart (but you will have to lsnrstart LISTENER1 and LISTERNER2 first anyway because dbstart starts only the default LISTENER)</p><pre name="2a85" id="2a85" class="graf graf--pre graf-after--p">sudo sed -ie &#39;/^CDB1[AB]:/s/:N$/:Y/&#39; /etc/oratab</pre><p name="b8e2" id="b8e2" class="graf graf--p graf-after--pre"># archivelog deleted on both side without need to backup them (as long as there are no gap)</p><pre name="6347" id="6347" class="graf graf--pre graf-after--p">for i in CDB1{B,A} ; do ORACLE_SID=$i rman target / &lt;&lt;&lt;&#39;<strong class="markup--strong markup--pre-strong">configure archivelog deletion policy</strong> to <strong class="markup--strong markup--pre-strong">applied on all standby</strong>;&#39; ; done</pre><p name="f503" id="f503" class="graf graf--p graf-after--pre"># Some verifications and testing two switchovers so that we know it works</p><pre name="c12e" id="c12e" class="graf graf--pre graf-after--p">for i in {<strong class="markup--strong markup--pre-strong">1521</strong>..<strong class="markup--strong markup--pre-strong">1522</strong>} ; do lsnrctl status //$(hostname):$i ; done<br>grep ^<strong class="markup--strong markup--pre-strong">CDB1</strong>[AB] /etc/oratab</pre><pre name="1f9a" id="1f9a" class="graf graf--pre graf-after--pre">sleep 15<br>dgmgrl sys/oracle &lt;&lt;&lt;&#39;show configuration&#39;<br>dgmgrl sys/oracle &lt;&lt;&lt;&#39;show database verbose CDB1B&#39;</pre><pre name="72c2" id="72c2" class="graf graf--pre graf-after--pre">sleep 15<br>dgmgrl sys/oracle &lt;&lt;&lt;&#39;validate database CDB1B&#39; | grep -EC99 &quot;Ready for Switchover: *Yes&quot; &amp;&amp; dgmgrl sys/oracle &lt;&lt;&lt;&#39;<strong class="markup--strong markup--pre-strong">switchover to CDB1B</strong>&#39;</pre><pre name="2958" id="2958" class="graf graf--pre graf-after--pre">sleep 15<br>dgmgrl sys/oracle &lt;&lt;&lt;&#39;validate database CDB1A&#39; | grep -EC99 &quot;Ready for Switchover: *Yes&quot; &amp;&amp; dgmgrl sys/oracle &lt;&lt;&lt;&#39;<strong class="markup--strong markup--pre-strong">switchover to CDB1A</strong>&#39;</pre><p name="a03a" id="a03a" class="graf graf--p graf-after--pre"><em class="markup--em markup--p-em"># dgmgrl can take a command as argument, but I like bash Here strings.</em></p><h4 name="4074" id="4074" class="graf graf--h4 graf-after--p">Drop the databases</h4><p name="890f" id="890f" class="graf graf--p graf-after--h4">The following will clean everything (drop databases CDB1A and CDB1B and listeners)</p><pre name="b3b2" id="b3b2" class="graf graf--pre graf-after--p">exit # this to prevent and eager copy/paste</pre><pre name="d46f" id="d46f" class="graf graf--pre graf-after--pre">ORACLE_HOME=/u01/app/oracle/product/DB192<br>mkdir -p /u01/oradata /u01/fast_recovery_area</pre><pre name="7d59" id="7d59" class="graf graf--pre graf-after--pre">for i in $(awk -F: &#39;/^CDB[1-2][A-B]?:/{print $1}&#39; /etc/oratab | sort -r)<br>do<br> $ORACLE_HOME/bin/<strong class="markup--strong markup--pre-strong">dbca -silent -deleteDatabase</strong> -sourceDB $i \<br> -forceArchiveLogDeletion -sysDBAPassword oracle -sysDBAUserName sys<br>done</pre><pre name="8afa" id="8afa" class="graf graf--pre graf-after--pre">for i in {1521..1524} ; do lsnrctl stop //$(hostname):$i ; done</pre><pre name="0dfc" id="0dfc" class="graf graf--pre graf-after--pre">rm -rf /u01/oradata/CDB1* \<br>       /u01/fast_recovery_area/CDB1* \<br>       $ORACLE_HOME/network/admin/{listener,tnsnames,sqlnet}.ora \<br>       /u01/app/oracle/cfgtoollogs/dbca/CDB1{A,B} \<br>       /u01/app/oracle/diag/rdbms/*/CDB1{A,B} \<br>       $ORACLE_HOME/dbs/*{A,B}*\<br>       $ORACLE_HOME/rdbms/log/*{A,B}*\<br>       $ORACLE_HOME/rdbms/audit/*{A,B}*</pre><p name="9271" id="9271" class="graf graf--p graf-after--pre">I do the same with a CDB2 database and that’s my sandbox for many demos. Something like copy/pasting the previous commands through</p><pre name="1e10" id="1e10" class="graf graf--pre graf-after--p">sed -e s/CDB1/CDB2/g  s/LISTENER1/LISTENER2/g  s/1521/1523/g s/1522/1524/g s/PDB1/PDB2/g | sh</pre><p name="3c0d" id="3c0d" class="graf graf--p graf-after--pre graf--trailing">In summary, DBCA automates the duplicate for standby. It would be nice to get the listeners created properly with static strings, and the Data Guard Broker configuration setup as well. And also standby redo log creation.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/88aab20ea0ab"><time class="dt-published" datetime="2019-03-06T17:03:55.860Z">March 6, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/oracle-19c-data-guard-sandbox-created-by-dbca-createduplicatedb-88aab20ea0ab" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>