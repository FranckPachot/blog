<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Hibernate for Oracle DBAs</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Hibernate for Oracle DBAs</h1>
</header>
<section data-field="subtitle" class="p-summary">
Warning: any smart developer may feel sick when reading this ;)
</section>
<section data-field="body" class="e-content">
<section name="4d30" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e90e" id="e90e" class="graf graf--h3 graf--leading graf--title">Hibernate for Oracle DBAs</h3><h4 name="e8fe" id="e8fe" class="graf graf--h4 graf-after--h3 graf--subtitle">Warning: any smart developer may feel sick when reading this ;)</h4><p name="c08b" id="c08b" class="graf graf--p graf-after--h4">I am not a developer, but I like to discuss with developers: share my side of the IT (the database that we want rock stable and durable) and listen to their side (the application that they want easy to maintain and evolve). And, as I like to understand what I’m talking about, I often need to test some snippets.</p><p name="655d" id="655d" class="graf graf--p graf-after--p">Many DBAs complain about Hibernate when they come upon the queries generated by a wrong mapping. They think it was designed to be bad (who would do that?). And they are convinced that JDBC and SQL are sufficient to build applications. Actually, many DBAs I have seen are persuaded that they understand everything about coding because they have written some ugly PERL scripts to automate their job. And that anything going beyond has the only goal to break the database.</p><p name="51b7" id="51b7" class="graf graf--p graf-after--p">I didn’t go this way. As I like to understand before building my opinion, I have read “Hibernate In Action” and tested some object to relational mapping. I’m talking about Hibernate 3 times here. I’ve found those tests in a folder from 2008. I re-used this today for a short test and that’s the reason for this post.</p><p name="1e4d" id="1e4d" class="graf graf--p graf-after--p">Here I am showing how I’m doing those small tests with Hibernate. I’m a DBA and I cannot have an Eclipse environment taking all my screens, hiding those database top activity charts. And all my RAM is already eaten by SQL Developer and Chrome Grid Control windows, no room for Eclipse. And anyway, those mouse-focused IDEs are not friends with my carpal tunnel. I like the keyboard and tty.</p><p name="ffea" id="ffea" class="graf graf--p graf-after--p">So, for simple tests, I need simple things which can be reduced to a command line and 1 file that I can open with vi. The goal of this post is to show how it is easy to test some Hibernate thing in this case. Of course, any real developer will vomit when looking at this… don’t forget this is about short tests only.</p><h3 name="47df" id="47df" class="graf graf--h3 graf-after--p">Libraries</h3><p name="2c1d" id="2c1d" class="graf graf--p graf-after--h3">So, no Maven for me. I download the whole Hibernate .zip and build a CLASSPATH with everything I found in the required lib folder.</p><pre name="374e" id="374e" class="graf graf--pre graf-after--p">wget <a href="https://netix.dl.sourceforge.net/project/hibernate/hibernate-orm/5.4.3.Final/hibernate-release-5.4.3.Final.zip" data-href="https://netix.dl.sourceforge.net/project/hibernate/hibernate-orm/5.4.3.Final/hibernate-release-5.4.3.Final.zip" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://netix.dl.sourceforge.net/project/hibernate/hibernate-orm/5.4.3.Final/hibernate-release-5.4.3.Final.zip</a></pre><pre name="7815" id="7815" class="graf graf--pre graf-after--pre">unzip hibernate-release-5.4.3.Final.zip</pre><pre name="7711" id="7711" class="graf graf--pre graf-after--pre">for i in hibernate-release-5.4.3.Final/lib/required/*.jar <br>do<br> CLASSPATH=&quot;${CLASSPATH}:$i&quot;<br>done<br>export CLASSPATH=.:$ORACLE_HOME/jdbc/lib/ojdbc8.jar:$CLASSPATH</pre><p name="4ccc" id="4ccc" class="graf graf--p graf-after--pre">You can see that I’ve added the Oracle JDBC as I’ll connect to an Oracle database that I have locally (I use Oracle Cloud DBaaS here).</p><h3 name="a9ac" id="a9ac" class="graf graf--h3 graf-after--p">Compile</h3><p name="5b57" id="5b57" class="graf graf--p graf-after--h3">No Ant here. I compile the .java files I have in my folder (I don’t use packages and subfolders for simple tests). Note that, from a past admiration for makefiles, I add enough intelligence (like “test -nt”) to compile only when the code is <strong class="markup--strong markup--p-strong">n</strong>ewer <strong class="markup--strong markup--p-strong">t</strong>han the source.</p><pre name="d44c" id="d44c" class="graf graf--pre graf-after--p">for i in *.java<br>do<br> if [ $i -nt $(basename $i .java).class ]<br> then<br>  $ORACLE_HOME/jdk/bin/javac $i<br> fi<br>done</pre><h3 name="2c24" id="2c24" class="graf graf--h3 graf-after--pre">ORM Mapping</h3><p name="3121" id="3121" class="graf graf--p graf-after--h3">My goal was to quickly test the following mapping from <a href="https://mobile.twitter.com/vlad_mihalcea" data-href="https://mobile.twitter.com/vlad_mihalcea" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@vlad_mihalcea</a>:</p><div name="c775" id="c775" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://vladmihalcea.com/the-best-way-to-map-a-composite-primary-key-with-jpa-and-hibernate/" data-href="https://vladmihalcea.com/the-best-way-to-map-a-composite-primary-key-with-jpa-and-hibernate/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://vladmihalcea.com/the-best-way-to-map-a-composite-primary-key-with-jpa-and-hibernate/"><strong class="markup--strong markup--mixtapeEmbed-strong">The best way to map a Composite Primary Key with JPA and Hibernate - Vlad Mihalcea</strong><br><em class="markup--em markup--mixtapeEmbed-em">(Last Updated On: January 22, 2019)Introduction One of my readers asked me to help him map a Composite Primary Key…</em>vladmihalcea.com</a><a href="https://vladmihalcea.com/the-best-way-to-map-a-composite-primary-key-with-jpa-and-hibernate/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="d33171a3066a6a46db390db735b7d385" data-thumbnail-img-id="0*-gbqouZFe-q_IZbV" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*-gbqouZFe-q_IZbV);"></a></div><p name="a4cf" id="a4cf" class="graf graf--p graf-after--mixtapeEmbed">So what do I have in those .java files? Testing Hibernate needs having many classes. And in Java, each class goes to its own file. But did I say that I want to open only 1 file? I use inner classes.</p><pre name="f161" id="f161" class="graf graf--pre graf-after--p">import java.io.*;<br>import java.sql.*;<br>import java.util.*;<br>import oracle.jdbc.*;<br>import org.hibernate.*;<br>import org.hibernate.cfg.*;<br>import javax.persistence.*;</pre><pre name="d94a" id="d94a" class="graf graf--pre graf-after--pre">public class Franck {</pre><pre name="6abe" id="6abe" class="graf graf--pre graf-after--pre"><a href="http://twitter.com/Entity" data-href="http://twitter.com/Entity" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Entity" rel="noopener" target="_blank">@Entity</a>(name = &quot;Company&quot;)<br><a href="http://twitter.com/Table" data-href="http://twitter.com/Table" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Table" rel="noopener" target="_blank">@Table</a>(name = &quot;company&quot;)<br>public class Company {</pre><pre name="dacf" id="dacf" class="graf graf--pre graf-after--pre">    <a href="http://twitter.com/Id" data-href="http://twitter.com/Id" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Id" rel="noopener" target="_blank">@Id</a><br>    <a href="http://twitter.com/GeneratedValue" data-href="http://twitter.com/GeneratedValue" class="markup--anchor markup--pre-anchor" title="Twitter profile for @GeneratedValue" rel="noopener" target="_blank">@GeneratedValue</a>(strategy=GenerationType.IDENTITY)<br>    private Long id;</pre><pre name="ca31" id="ca31" class="graf graf--pre graf-after--pre">    private String name;</pre><pre name="e9f7" id="e9f7" class="graf graf--pre graf-after--pre">    public Long getId() {<br>        return id;<br>    }<br>    public void setId(Long id) {<br>        this.id = id;<br>    }<br>    public String getName() {<br>        return name;<br>    }<br>    public void setName(String name) {<br>        this.name = name;<br>    }<br>    <a href="http://twitter.com/Override" data-href="http://twitter.com/Override" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Override" rel="noopener" target="_blank">@Override</a><br>    public boolean equals(Object o) {<br>        if (this == o) return true;<br>        if (!(o instanceof Company)) return false;<br>        Company company = (Company) o;<br>        return Objects.equals(getName(), company.getName());<br>    }<br>    <a href="http://twitter.com/Override" data-href="http://twitter.com/Override" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Override" rel="noopener" target="_blank">@Override</a><br>    public int hashCode() {<br>        return Objects.hash(getName());<br>    }<br>}</pre><pre name="ca55" id="ca55" class="graf graf--pre graf-after--pre"><a href="http://twitter.com/Embeddable" data-href="http://twitter.com/Embeddable" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Embeddable" rel="noopener" target="_blank">@Embeddable</a><br>public class EmployeeId implements Serializable {<br>    <a href="http://twitter.com/ManyToOne" data-href="http://twitter.com/ManyToOne" class="markup--anchor markup--pre-anchor" title="Twitter profile for @ManyToOne" rel="noopener" target="_blank">@ManyToOne</a><br>    <a href="http://twitter.com/JoinColumn" data-href="http://twitter.com/JoinColumn" class="markup--anchor markup--pre-anchor" title="Twitter profile for @JoinColumn" rel="noopener" target="_blank">@JoinColumn</a>(name = &quot;company_id&quot;)<br>    private Company company;</pre><pre name="a5d0" id="a5d0" class="graf graf--pre graf-after--pre">    <a href="http://twitter.com/Column" data-href="http://twitter.com/Column" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Column" rel="noopener" target="_blank">@Column</a>(name = &quot;employee_number&quot;)<br>    private Long employeeNumber;</pre><pre name="1132" id="1132" class="graf graf--pre graf-after--pre">    public EmployeeId() {<br>    }<br>    public EmployeeId(Company company, Long employeeId) {<br>        this.company = company;<br>        this.employeeNumber = employeeId;<br>    }<br>    public Company getCompany() {<br>        return company;<br>    }<br>    public Long getEmployeeNumber() {<br>        return employeeNumber;<br>    }<br>    <a href="http://twitter.com/Override" data-href="http://twitter.com/Override" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Override" rel="noopener" target="_blank">@Override</a><br>    public boolean equals(Object o) {<br>        if (this == o) return true;<br>        if (!(o instanceof EmployeeId)) return false;<br>        EmployeeId that = (EmployeeId) o;<br>        return Objects.equals(getCompany(), that.getCompany()) &amp;&amp;<br>                Objects.equals(getEmployeeNumber(), that.getEmployeeNumber());<br>    }<br>    <a href="http://twitter.com/Override" data-href="http://twitter.com/Override" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Override" rel="noopener" target="_blank">@Override</a><br>    public int hashCode() {<br>        return Objects.hash(getCompany(), getEmployeeNumber());<br>    }<br>}</pre><pre name="7e88" id="7e88" class="graf graf--pre graf-after--pre"><a href="http://twitter.com/Entity" data-href="http://twitter.com/Entity" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Entity" rel="noopener" target="_blank">@Entity</a>(name = &quot;Employee&quot;)<br><a href="http://twitter.com/Table" data-href="http://twitter.com/Table" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Table" rel="noopener" target="_blank">@Table</a>(name = &quot;employee&quot;)<br>public class Employee {<br>    <a href="http://twitter.com/EmbeddedId" data-href="http://twitter.com/EmbeddedId" class="markup--anchor markup--pre-anchor" title="Twitter profile for @EmbeddedId" rel="noopener" target="_blank">@EmbeddedId</a><br>    private EmployeeId id;</pre><pre name="7750" id="7750" class="graf graf--pre graf-after--pre">    private String name;</pre><pre name="43ec" id="43ec" class="graf graf--pre graf-after--pre">    public EmployeeId getId() {<br>        return id;<br>    }<br>    public void setId(EmployeeId id) {<br>        this.id = id;<br>    }<br>    public String getName() {<br>        return name;<br>    }<br>    public void setName(String name) {<br>        this.name = name;<br>    }<br>}</pre><pre name="501b" id="501b" class="graf graf--pre graf-after--pre">public static void main(String[] args) throws SQLException {<br> SessionFactory sf=new Configuration()<br>  .addAnnotatedClass(Employee.class)<br>  .addAnnotatedClass(Company.class)<br>  .setProperty(&quot;hibernate.connection.url&quot;,&quot;jdbc:oracle:thin:@//localhost/PDB1&quot;)<br>  .setProperty(&quot;hibernate.connection.driver_class&quot;,&quot;oracle.jdbc.driver.OracleDriver&quot;)<br>  .setProperty(&quot;hibernate.connection.username&quot;,&quot;demo&quot;)<br>  .setProperty(&quot;hibernate.connection.password&quot;,&quot;demo&quot;)<br>  .setProperty(&quot;hibernate.format_sql&quot;,&quot;true&quot;)<br>  .setProperty(&quot;hibernate.show_sql&quot;,&quot;true&quot;)<br>  .setProperty(&quot;hibernate.hbm2ddl.auto&quot;,&quot;create&quot;)<br>  .buildSessionFactory();</pre><pre name="695e" id="695e" class="graf graf--pre graf-after--pre">}</pre><pre name="b018" id="b018" class="graf graf--pre graf-after--pre">}</pre><p name="bfd9" id="bfd9" class="graf graf--p graf-after--pre">The main class name (here Franck) matches the file name (Franck.java) and all my entities are inner classes here. After compilation here are my files:</p><pre name="0376" id="0376" class="graf graf--pre graf-after--p">-rwxr--r--. 1 oracle 4931 Jun  5 20:18 Franck.java<br>-rw-r--r--. 1 oracle 1304 Jun  5 20:19 Franck$Company.class<br>-rw-r--r--. 1 oracle 1398 Jun  5 20:19 Franck$EmployeeId.class<br>-rw-r--r--. 1 oracle  922 Jun  5 20:19 Franck$Employee.class<br>-rw-r--r--. 1 oracle 1557 Jun  5 20:19 Franck.class</pre><h3 name="5442" id="5442" class="graf graf--h3 graf-after--pre">Execution</h3><pre name="0bc0" id="0bc0" class="graf graf--pre graf-after--h3">$ORACLE_HOME/jdk/bin/java Franck</pre><p name="eba9" id="eba9" class="graf graf--p graf-after--pre">This generates the following:</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="b155" id="b155" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 761px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 73.7%;"></div><img class="graf-image" data-image-id="1*bf8X-TJLUODNXPH31uqjRw.png" data-width="2078" data-height="1532" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1200/1*bf8X-TJLUODNXPH31uqjRw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="0660" id="0660" class="graf graf--p graf-after--figure">That’s all I need to verify what my annotations generate with the Oracle 12c Dialect. Ugly on-file code, but sufficient for this goal.</p><h3 name="490a" id="490a" class="graf graf--h3 graf-after--p">Java as a Shell</h3><p name="4a9d" id="4a9d" class="graf graf--p graf-after--h3">Ok, now that I think that any real developer has stopped reading, I can confess that I add the following on the top of my .java file:</p><pre name="fbd1" id="fbd1" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">/*</strong>TAG-FOR-SHELL 2&gt;/dev/null</pre><pre name="754c" id="754c" class="graf graf--pre graf-after--pre">CLASSPATH=.</pre><pre name="8618" id="8618" class="graf graf--pre graf-after--pre"># Oracle JDBC<br>CLASSPATH=${CLASSPATH}:$ORACLE_HOME/jdbc/lib/ojdbc8.jar</pre><pre name="ffb9" id="ffb9" class="graf graf--pre graf-after--pre"># Download Hibernate<br>[ -f /var/tmp/hibernate.zip ] || wget -O /var/tmp/hibernate.zip <a href="https://netix.dl.sourceforge.net/project/hibernate/hibernate-orm/5.4.3.Final/hibernate-release-5.4.3.Final.zip" data-href="https://netix.dl.sourceforge.net/project/hibernate/hibernate-orm/5.4.3.Final/hibernate-release-5.4.3.Final.zip" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://netix.dl.sourceforge.net/project/hibernate/hibernate-orm/5.4.3.Final/hibernate-release-5.4.3.Final.zip</a><br># Unzip Hibernate<br>[ -d /var/tmp/hibernate*?/lib/required ] || unzip -d /var/tmp /var/tmp/hibernate.zip<br># add libs to CLASSPATH<br>for l in /var/tmp/hibernate*?/lib/required/*.jar ; do CLASSPATH=&quot;${CLASSPATH}:$l&quot; ; done ; export CLASSPATH</pre><pre name="e2da" id="e2da" class="graf graf--pre graf-after--pre"># compile all Java<br>for s in $(find -name &quot;*.java&quot;); do<br>s=&quot;$(basename $s .java)&quot;<br>[ $s.java -nt $s.class ] &amp;&amp; {<br>        echo &quot;Compiling $s...&quot; &gt;&amp;2<br>        $ORACLE_HOME/jdk/bin/javac $s.java || exit 1<br>}<br>done</pre><pre name="eb90" id="eb90" class="graf graf--pre graf-after--pre"># execute<br>$ORACLE_HOME/jdk/bin/java $(basename <strong class="markup--strong markup--pre-strong">$0</strong> .java)</pre><pre name="74b4" id="74b4" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">exit</strong><br><strong class="markup--strong markup--pre-strong">*/</strong></pre><p name="9215" id="9215" class="graf graf--p graf-after--pre">And then I “chmod u+x” this .java file and run it as a shell. The shell part is included in Java comment so that this file can be compiled as Java source code. And it gets the libraries if not there already, builds CLASSPATH, compile what’s new in the directory, and run it as a Java program. all that with a simple:</p><pre name="7217" id="7217" class="graf graf--pre graf-after--p">./Franck.java</pre><p name="d884" id="d884" class="graf graf--p graf-after--pre graf--trailing">Any comments welcome on Twitter: <a href="https://mobile.twitter.com/franckpachot" data-href="https://mobile.twitter.com/franckpachot" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@FranckPachot</a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/d57a8c8c2ca9"><time class="dt-published" datetime="2019-06-05T20:41:08.225Z">June 5, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/hibernate-for-oracle-dbas-d57a8c8c2ca9" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>