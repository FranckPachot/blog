<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>19c DG Broker export/import configuration</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">19c DG Broker export/import configuration</h1>
</header>
<section data-field="subtitle" class="p-summary">
This is something I wanted for a long time: be able to save a broker configuration to be able to re-configure it if needed. What I usually…
</section>
<section data-field="body" class="e-content">
<section name="471a" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6ddf" id="6ddf" class="graf graf--h3 graf--leading graf--title">19c DG Broker export/import configuration</h3><p name="30f6" id="30f6" class="graf graf--p graf-after--h3">This is something I wanted for a long time: be able to save a broker configuration to be able to re-configure it if needed. What I usually do is maintain a script with all commands. What I dreamed was being able to export the configuration as a script. What we have now, in 19c, is the ability to export/import the configuration as a .xml file.</p><p name="b6e0" id="b6e0" class="graf graf--p graf-after--p">Actually, the configuration is already stored as XML in the broker configuration files (the .dat ones):</p><pre name="93a1" id="93a1" class="graf graf--pre graf-after--p">SQLcl: Release 18.4 Production on Tue Feb 19 13:40:27 2019</pre><pre name="c1f8" id="c1f8" class="graf graf--pre graf-after--pre">Copyright (c) 1982, 2019, Oracle.  All rights reserved.</pre><pre name="ac12" id="ac12" class="graf graf--pre graf-after--pre">Connected to:<br>Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production<br>Version 19.2.0.0.0</pre><pre name="a215" id="a215" class="graf graf--pre graf-after--pre">SQL&gt; show parameter broker<br>NAME                   TYPE    VALUE<br>---------------------- ------- -------------------------------------<br>dg_broker_config_file1 string  ?/dbs/dr1CDB1A.dat<br>dg_broker_config_file2 string  ?/dbs/dr2CDB1A.dat<br>dg_broker_start        boolean TRUE</pre><p name="58ca" id="58ca" class="graf graf--p graf-after--pre">Those are binary files, but we can look at the content with ‘strings’. And since 12cR2 the content shows some XML. In all versions, we can see a message from the authors, ‘fine folks at NEDC’. Here is where this was developed:</p><div name="db05" id="db05" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.oracle.com/technetwork/database/rdb/nedc-facility-info-087223.html" data-href="https://www.oracle.com/technetwork/database/rdb/nedc-facility-info-087223.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.oracle.com/technetwork/database/rdb/nedc-facility-info-087223.html"><strong class="markup--strong markup--mixtapeEmbed-strong">NEDC Facility Information</strong><br><em class="markup--em markup--mixtapeEmbed-em">nedc-facility-info</em>www.oracle.com</a><a href="https://www.oracle.com/technetwork/database/rdb/nedc-facility-info-087223.html" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="8bde0b73e1294788d1482b0d7f9a03b9" data-thumbnail-img-id="0*CdKqb0lel2mQW2K5" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*CdKqb0lel2mQW2K5);"></a></div><p name="1c9e" id="1c9e" class="graf graf--p graf-after--mixtapeEmbed">So here are the strings in my broker file:</p><pre name="bca8" id="bca8" class="graf graf--pre graf-after--p">[oracle@db192 ~]$ strings /u01/app/oracle/product/DB192/dbs/dr1CDB1A.dat<br>}|{z<br>cdb1a<br>cdb1a<br><strong class="markup--strong markup--pre-strong">Brought to you by the fine folks at NEDC.<br>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br></strong>&lt;DRC Version=&quot;19.2.0.0.0&quot; CurrentPath=&quot;True&quot; Name=&quot;cdb1a&quot;&gt;<br>  &lt;DefaultState&gt;ONLINE&lt;/DefaultState&gt;<br>  &lt;DRC_UNIQUE_ID&gt;1934436017&lt;/DRC_UNIQUE_ID&gt;<br>  &lt;IntendedState&gt;ONLINE&lt;/IntendedState&gt;<br>  &lt;FastStartFailoverOBID1&gt;1673904225&lt;/FastStartFailoverOBID1&gt;<br>  &lt;FastStartFailoverOBID2&gt;1673904226&lt;/FastStartFailoverOBID2&gt;<br>  &lt;FastStartFailoverOBID3&gt;1673904227&lt;/FastStartFailoverOBID3&gt;<br>  &lt;Configuration_Name&gt;cdb1a&lt;/Configuration_Name&gt;<br>  &lt;Member MemberID=&quot;1&quot; CurrentPath=&quot;True&quot; Enabled=&quot;True&quot; MultiInstanced=&quot;True&quot; Name=&quot;cdb1a&quot;&gt;<br>    &lt;IntendedState&gt;PRIMARY&lt;/IntendedState&gt;<br>    &lt;DefaultState&gt;PRIMARY&lt;/DefaultState&gt;<br>...<br>      &lt;OldPrimary&gt;cdb1b&lt;/OldPrimary&gt;<br>      &lt;NewPrimary&gt;cdb1a&lt;/NewPrimary&gt;<br>      &lt;Status&gt;0&lt;/Status&gt;<br>      &lt;Timestamp&gt;1000647508&lt;/Timestamp&gt;<br>    &lt;/RoleChangeRecord&gt;<br>  &lt;/RoleChangeHistory&gt;<br>  &lt;MIV&gt;0&lt;/MIV&gt;<br>  &lt;PRIMARY_SITE_ID&gt;513&lt;/PRIMARY_SITE_ID&gt;<br>&lt;/DRC&gt;</pre><p name="e984" id="e984" class="graf graf--p graf-after--pre">If you want to know more about those, my ex-colleague William Sescu at dbi-services explained everything:</p><div name="458d" id="458d" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://blog.dbi-services.com/oracle-12c-how-to-recover-lost-dataguard-broker-configuration-files/" data-href="https://blog.dbi-services.com/oracle-12c-how-to-recover-lost-dataguard-broker-configuration-files/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://blog.dbi-services.com/oracle-12c-how-to-recover-lost-dataguard-broker-configuration-files/"><strong class="markup--strong markup--mixtapeEmbed-strong">Oracle 12c - How to Recover lost DataGuard Broker Configuration Files - Blog dbi services</strong><br><em class="markup--em markup--mixtapeEmbed-em">By William Sescu If you are using RMAN to back up your database, you are already doing the right thing. However, RMAN…</em>blog.dbi-services.com</a><a href="https://blog.dbi-services.com/oracle-12c-how-to-recover-lost-dataguard-broker-configuration-files/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="29e1f9c025f8c82168255fcb8d60ab17" data-thumbnail-img-id="0*IFiiNQPhxp9-daf4" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*IFiiNQPhxp9-daf4);"></a></div><p name="edc8" id="edc8" class="graf graf--p graf-after--mixtapeEmbed">Now in 19c, no need to parse that as we can export this metadata in a well-formatted XML:</p><pre name="e89f" id="e89f" class="graf graf--pre graf-after--p">[oracle@db192 ~]$ dgmgrl /<br>DGMGRL for Linux: Release 19.0.0.0.0 - Production on Tue Feb 19 13:46:05 2019<br>Version 19.2.0.0.0</pre><pre name="a994" id="a994" class="graf graf--pre graf-after--pre">Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.</pre><pre name="a0a4" id="a0a4" class="graf graf--pre graf-after--pre">Welcome to DGMGRL, type &quot;help&quot; for information.<br>Connected to &quot;CDB1B&quot;<br>Connected as SYSDG.<br>DGMGRL&gt; <strong class="markup--strong markup--pre-strong">export configuration to MYCONFIG;</strong><br>Succeeded.<br>DGMGRL&gt;</pre><p name="51e4" id="51e4" class="graf graf--p graf-after--pre">You cannot mention a full path as the file goes to the diag trace directory (the one called ‘udump’ by the seasoned DBAs). If you are not sure, the broker trace shows it:</p><pre name="6ecf" id="6ecf" class="graf graf--pre graf-after--p">The Data Guard broker metadata is exported to /u01/app/oracle/diag/rdbms/cdb1b/CDB1B/trace/<strong class="markup--strong markup--pre-strong">myconfig</strong></pre><p name="9567" id="9567" class="graf graf--p graf-after--pre">Here you see that it was transformed to lower-case, as usual in DGMGRL, but you can also quote it to make it case sensitive. What this doesn’t show is that when you do not provide an extension, ‘.log’ will be added (which is a funny default for an XML file…)</p><pre name="a468" id="a468" class="graf graf--pre graf-after--p">[oracle@db192 trace]$ ls -alrt $ORACLE_BASE/diag/rdbms/*/$ORACLE_SID/trace/*myconfig*<br>-rw-r--r--. 1 oracle oinstall 4992 Feb 19 13:46 /u01/app/oracle/diag/rdbms/cdb1b/CDB1B/trace/<strong class="markup--strong markup--pre-strong">myconfig.log</strong></pre><p name="cada" id="cada" class="graf graf--p graf-after--pre">If you compare it with the .dat you will see that the XML content is exactly the same:</p><pre name="e0e9" id="e0e9" class="graf graf--pre graf-after--p">[oracle@db192 trace]$ cat /u01/app/oracle/diag/rdbms/cdb1b/CDB1B/trace/<strong class="markup--strong markup--pre-strong">myconfig.log</strong></pre><pre name="f30a" id="f30a" class="graf graf--pre graf-after--pre">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;DRC Version=&quot;19.2.0.0.0&quot; CurrentPath=&quot;True&quot; Name=&quot;cdb1a&quot;&gt;<br>  &lt;DefaultState&gt;ONLINE&lt;/DefaultState&gt;<br>  &lt;DRC_UNIQUE_ID&gt;1934436017&lt;/DRC_UNIQUE_ID&gt;<br>  &lt;IntendedState&gt;ONLINE&lt;/IntendedState&gt;<br>  &lt;FastStartFailoverOBID1&gt;1673904225&lt;/FastStartFailoverOBID1&gt;<br>  &lt;FastStartFailoverOBID2&gt;1673904226&lt;/FastStartFailoverOBID2&gt;<br>  &lt;FastStartFailoverOBID3&gt;1673904227&lt;/FastStartFailoverOBID3&gt;<br>  &lt;Configuration_Name&gt;cdb1a&lt;/Configuration_Name&gt;<br>  &lt;Member MemberID=&quot;1&quot; CurrentPath=&quot;True&quot; Enabled=&quot;True&quot; MultiInstanced=&quot;True&quot; Name=&quot;cdb1a&quot;&gt;<br>    &lt;IntendedState&gt;PRIMARY&lt;/IntendedState&gt;<br>    &lt;DefaultState&gt;PRIMARY&lt;/DefaultState&gt;<br>...<br>      &lt;OldPrimary&gt;cdb1b&lt;/OldPrimary&gt;<br>      &lt;NewPrimary&gt;cdb1a&lt;/NewPrimary&gt;<br>      &lt;Status&gt;0&lt;/Status&gt;<br>      &lt;Timestamp&gt;1000647508&lt;/Timestamp&gt;<br>    &lt;/RoleChangeRecord&gt;<br>  &lt;/RoleChangeHistory&gt;<br>  &lt;MIV&gt;0&lt;/MIV&gt;<br>  &lt;PRIMARY_SITE_ID&gt;513&lt;/PRIMARY_SITE_ID&gt;<br>&lt;/DRC&gt;</pre><p name="8d9b" id="8d9b" class="graf graf--p graf-after--pre">Once you have the export, I test it by removing the configuration and import it:</p><pre name="4618" id="4618" class="graf graf--pre graf-after--p">DGMGRL&gt; <strong class="markup--strong markup--pre-strong">import configuration from myconfig;</strong><br>Succeeded. Run ENABLE CONFIGURATION to enable the imported configuration.<br>DGMGRL&gt; <strong class="markup--strong markup--pre-strong">enable configuration</strong><br>Enabled.</pre><p name="043b" id="043b" class="graf graf--p graf-after--pre">This import must be done from the primary or you get an error.</p><p name="3a3e" id="3a3e" class="graf graf--p graf-after--p">Actually, the XML file is cool because it has more information than just the configuration commands. Here is the XML formatted in <a href="https://countwordsfree.com/xmlviewer" data-href="https://countwordsfree.com/xmlviewer" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://countwordsfree.com/xmlviewer</a>:</p><figure name="0acf" id="0acf" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 467px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 66.7%;"></div><img class="graf-image" data-image-id="1*xgSd0pgG1zHXt-crPLQUhg.png" data-width="2462" data-height="1641" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*xgSd0pgG1zHXt-crPLQUhg.png"></div></figure><p name="b526" id="b526" class="graf graf--p graf-after--figure">Here I have the history of the last 10 switchovers which can be very useful. And then you want to know what is this timestamp unit?</p><p name="ca1b" id="ca1b" class="graf graf--p graf-after--p">In the XML file you will find many timestamps.</p><p name="6663" id="6663" class="graf graf--p graf-after--p">Most of them are EPOCH, the number of seconds since 01-JAN-1970:</p><pre name="53c7" id="53c7" class="graf graf--pre graf-after--p">&lt;Status&gt;<br>    &lt;Severity&gt;Success&lt;/Severity&gt;<br>    &lt;Error&gt;0&lt;/Error&gt;<br>    &lt;Timestamp&gt;1550611393&lt;/Timestamp&gt;<br>  &lt;/Status&gt;</pre><p name="af63" id="af63" class="graf graf--p graf-after--pre">This, 19-FEB-2019 21:23:13 which is exactly when I exported this file.</p><p name="98ce" id="98ce" class="graf graf--p graf-after--p">But look at the switchover history:</p><pre name="fc1a" id="fc1a" class="graf graf--pre graf-after--p">&lt;RoleChangeRecord&gt;<br>      &lt;Event&gt;PhysicalSwitchover&lt;/Event&gt;<br>      &lt;OldPrimary&gt;cdb1a&lt;/OldPrimary&gt;<br>      &lt;NewPrimary&gt;cdb1b&lt;/NewPrimary&gt;<br>      &lt;Status&gt;0&lt;/Status&gt;<br>      &lt;Timestamp&gt;<strong class="markup--strong markup--pre-strong">1000674973</strong>&lt;/Timestamp&gt;<br>    &lt;/RoleChangeRecord&gt;<br>    &lt;RoleChangeRecord&gt;<br>      &lt;Event&gt;PhysicalSwitchover&lt;/Event&gt;<br>      &lt;OldPrimary&gt;cdb1b&lt;/OldPrimary&gt;<br>      &lt;NewPrimary&gt;cdb1a&lt;/NewPrimary&gt;<br>      &lt;Status&gt;0&lt;/Status&gt;<br>      &lt;Timestamp&gt;<strong class="markup--strong markup--pre-strong">1000675048</strong>&lt;/Timestamp&gt;<br>    &lt;/RoleChangeRecord&gt;<br>    &lt;RoleChangeRecord&gt;<br>      &lt;Event&gt;PhysicalSwitchover&lt;/Event&gt;<br>      &lt;OldPrimary&gt;cdb1a&lt;/OldPrimary&gt;<br>      &lt;NewPrimary&gt;cdb1b&lt;/NewPrimary&gt;<br>      &lt;Status&gt;0&lt;/Status&gt;<br>      &lt;Timestamp&gt;<strong class="markup--strong markup--pre-strong">1000675267</strong>&lt;/Timestamp&gt;<br>    &lt;/RoleChangeRecord&gt;<br>  &lt;/RoleChangeHistory&gt;</pre><p name="b936" id="b936" class="graf graf--p graf-after--pre graf--trailing">Those ones are the number of seconds since 06-JUN-1987 and are actually the time when the switchover command started: 19.02.19 at 21:16:13, 21:17:28, and 21:21:07.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/f4ce8a37bfe3"><time class="dt-published" datetime="2019-02-20T17:05:29.769Z">February 20, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/19c-dg-broker-export-import-configuration-f4ce8a37bfe3" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>