<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Avoid compound hints for better Hint Reporting in 19c</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Avoid compound hints for better Hint Reporting in 19c</h1>
</header>
<section data-field="subtitle" class="p-summary">
Even if the syntax accepts it, it is not a good idea to write a hint like:
</section>
<section data-field="body" class="e-content">
<section name="bde0" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4ab2" id="4ab2" class="graf graf--h3 graf--leading graf--title">Avoid compound hints for better Hint Reporting in 19c</h3><p name="8f78" id="8f78" class="graf graf--p graf-after--h3">Even if the syntax accepts it, it is not a good idea to write a hint like:</p><figure name="86d3" id="86d3" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 494px; max-height: 46px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 9.3%;"></div><img class="graf-image" data-image-id="0*npwbixTiGL5Knueb.gif" data-width="494" data-height="46" src="https://cdn-images-1.medium.com/max/600/0*npwbixTiGL5Knueb.gif"></div><figcaption class="imageCaption"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/sqlrf/Comments.html#GUID-56DAA0EC-54BB-4E9D-9049-BCEA934F7A89" data-href="https://docs.oracle.com/en/database/oracle/oracle-database/19/sqlrf/Comments.html#GUID-56DAA0EC-54BB-4E9D-9049-BCEA934F7A89" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">https://docs.oracle.com/en/database/oracle/oracle-database/19/sqlrf/Comments.html#GUID-56DAA0EC-54BB-4E9D-9049-BCEA934F7A89</a></figcaption></figure><p name="82cd" id="82cd" class="graf graf--p graf-after--figure">/*+ USE_NL(A B) */ with multiple aliases (‘tablespec’) even if it is documented.</p><p name="45fb" id="45fb" class="graf graf--p graf-after--p">One reason is that it is misleading. How many people think that this tells the optimizer to use a Nested Loop between A and B? That’s wrong. This hint just declares that Nested Loop should be used if possible when joining from any table to A, and for joining from any table to B.</p><p name="86b6" id="86b6" class="graf graf--p graf-after--p">Actually, this is a syntax shortcut for: /*+ USE_NL(A) USE_NL(B) */</p><p name="8d34" id="8d34" class="graf graf--p graf-after--p">The other reason is that the 19c Hint Reporting will not tell you wich join was possible or not. Here is an example:</p><pre name="4ff8" id="4ff8" class="graf graf--pre graf-after--p">SQL&gt; create table demo0 as select 1 x from dual;<br>Table DEMO0 created.</pre><pre name="1973" id="1973" class="graf graf--pre graf-after--pre">SQL&gt; create table demo1 as select 1 id from dual;<br>Table DEMO1 created.</pre><pre name="2b3b" id="2b3b" class="graf graf--pre graf-after--pre">SQL&gt; create table demo2 as select 1 id from dual;<br>Table DEMO2 created.</pre><pre name="7937" id="7937" class="graf graf--pre graf-after--pre">SQL&gt; explain plan for<br>     select <strong class="markup--strong markup--pre-strong">/*+ USE_HASH(demo1 demo2) */</strong> * <br>     from demo1 join demo2 using(id);</pre><pre name="8fb1" id="8fb1" class="graf graf--pre graf-after--pre">Explained.</pre><pre name="beec" id="beec" class="graf graf--pre graf-after--pre">SQL&gt; select * from dbms_xplan.display(format=&gt;&#39;basic +rows <strong class="markup--strong markup--pre-strong">+hint_report</strong>&#39;);</pre><pre name="05b8" id="05b8" class="graf graf--pre graf-after--pre">PLAN_TABLE_OUTPUT                                                   <br>--------------------------------------------------------------------<br>Plan hash value: 3212315601<br> <br>--------------------------------------------<br>| Id  | Operation          | Name  | Rows  |<br>--------------------------------------------<br>|   0 | SELECT STATEMENT   |       |     1 |<br>|   1 |  HASH JOIN         |       |     1 |<br>|   2 |   TABLE ACCESS FULL| DEMO1 |     1 |<br>|   3 |   TABLE ACCESS FULL| DEMO2 |     1 |<br>--------------------------------------------<br> <br>Hint Report (identified by operation id / Query Block Name / Object <br>Alias):</pre><pre name="f9af" id="f9af" class="graf graf--pre graf-after--pre">Total hints for statement: 2 (U - Unused (1))<br>--------------------------------------------------------------------</pre><pre name="9927" id="9927" class="graf graf--pre graf-after--pre">2 -  SEL$58A6D7F6 / DEMO1@SEL$1<br>         <strong class="markup--strong markup--pre-strong">U -  USE_HASH(demo1 demo2)</strong><br> <br>3 -  SEL$58A6D7F6 / DEMO2@SEL$1<br>          <strong class="markup--strong markup--pre-strong"> -  USE_HASH(demo1 demo2)</strong></pre><p name="6153" id="6153" class="graf graf--p graf-after--pre">Here, my hint was used to join to DEMO2 but not to join to DEMO1 because the optimizer didn’t choose a plan with DEMO1 as the inner table. This is reported by the 19c dbms_xplan: I have two lines, one for the used hint and one for the Unused one. But both mention the same hint because I used a compound syntax.</p><p name="72fc" id="72fc" class="graf graf--p graf-after--p">I have more detail in the PLAN_TABLE.OTHER_XML, with the state ‘NU’ but still mentioning the full hint with the two alias names:</p><pre name="0403" id="0403" class="graf graf--pre graf-after--p">SQL&gt; select cast(extract(xmltype(other_xml),&#39;//hint_usage/q/t/h&#39;) as varchar2(4000)) from plan_table where other_xml like &#39;%hint_usage%&#39;;</pre><pre name="22d5" id="22d5" class="graf graf--pre graf-after--pre">CAST(EXTRACT(XMLTYPE(OTHER_XML),&#39;//HINT_USAGE/Q/T/H&#39;)ASVARCHAR2(4000<br>--------------------------------------------------------------------<br>&lt;h o=&quot;EM&quot;&gt;&lt;x&gt;&lt;![CDATA[USE_HASH(demo1 demo2)]]&gt;&lt;/x&gt;&lt;/h&gt;<br>&lt;h o=&quot;EM&quot; <strong class="markup--strong markup--pre-strong">st=&quot;NU&quot;</strong>&gt;&lt;x&gt;&lt;![CDATA[<strong class="markup--strong markup--pre-strong">USE_HASH(demo1 demo2)</strong>]]&gt;&lt;/x&gt;&lt;/h&gt;</pre><p name="10ac" id="10ac" class="graf graf--p graf-after--pre">Now, running the same query with the two USE_HASH hints, one for each alias:</p><pre name="fb1a" id="fb1a" class="graf graf--pre graf-after--p">SQL&gt; explain plan for<br>     select <strong class="markup--strong markup--pre-strong">/*+ USE_HASH(demo1) USE_HASH(demo2) */</strong> * <br>     from demo1 join demo2 using(id);</pre><pre name="0317" id="0317" class="graf graf--pre graf-after--pre">Explained.</pre><pre name="7cd0" id="7cd0" class="graf graf--pre graf-after--pre">SQL&gt; select * from dbms_xplan.display(format=&gt;&#39;basic +rows <strong class="markup--strong markup--pre-strong">+hint_report</strong>&#39;);</pre><pre name="64f4" id="64f4" class="graf graf--pre graf-after--pre">PLAN_TABLE_OUTPUT<br>--------------------------------------------------------------------<br>Plan hash value: 3212315601<br> <br>--------------------------------------------<br>| Id  | Operation          | Name  | Rows  |<br>--------------------------------------------<br>|   0 | SELECT STATEMENT   |       |     1 |<br>|   1 |  HASH JOIN         |       |     1 |<br>|   2 |   TABLE ACCESS FULL| DEMO1 |     1 |<br>|   3 |   TABLE ACCESS FULL| DEMO2 |     1 |<br>--------------------------------------------<br> <br>Hint Report (identified by operation id / Query Block Name / Object Alias):<br>Total hints for statement: 2 (U - Unused (1))<br>--------------------------------------------------------------------<br> <br>   2 -  SEL$58A6D7F6 / DEMO1@SEL$1<br><strong class="markup--strong markup--pre-strong">         U -  USE_HASH(demo1)<br></strong> <br>   3 -  SEL$58A6D7F6 / DEMO2@SEL$1<br><strong class="markup--strong markup--pre-strong">           -  USE_HASH(demo2)</strong></pre><p name="66a5" id="66a5" class="graf graf--p graf-after--pre">Everything is clear now: the hint on DEMO1 was not used but the hint on DEMO2 was used.</p><pre name="19bb" id="19bb" class="graf graf--pre graf-after--p">SQL&gt; select cast(extract(xmltype(other_xml),&#39;//hint_usage/q/t/h&#39;) as varchar2(4000)) from plan_table where other_xml like &#39;%hint_usage%&#39;;</pre><pre name="d720" id="d720" class="graf graf--pre graf-after--pre">CAST(EXTRACT(XMLTYPE(OTHER_XML),&#39;//HINT_USAGE/Q/T/H&#39;)ASVARCHAR2(4000))<br>--------------------------------------------------------------------<br>&lt;h o=&quot;EM&quot;&gt;&lt;x&gt;&lt;![CDATA[USE_HASH(demo2)]]&gt;&lt;/x&gt;&lt;/h&gt;<br>&lt;h o=&quot;EM&quot; <strong class="markup--strong markup--pre-strong">st=&quot;NU&quot;</strong>&gt;&lt;x&gt;&lt;![CDATA[<strong class="markup--strong markup--pre-strong">USE_HASH(demo1)</strong>]]&gt;&lt;/x&gt;&lt;/h&gt;</pre><p name="59e7" id="59e7" class="graf graf--p graf-after--pre">Having the detail for each join hinted is also useful to get the reason. For example, if I hint with an inexistent alias, like /*+ USE_HASH(demo1) USE_HASH(demoX) */, I have two different reasons — ‘Unused’ and ‘uNresolved’:</p><pre name="6d57" id="6d57" class="graf graf--pre graf-after--p">Total hints for statement: 2 (U - Unused (1), N - Unresolved (1))<br>--------------------------------------------------------------------<br> <br>   1 -  SEL$58A6D7F6<br>         N -  USE_HASH(demoX)<br> <br>   2 -  SEL$58A6D7F6 / DEMO1@SEL$1<br>         U -  USE_HASH(demo1)</pre><p name="2b62" id="2b62" class="graf graf--p graf-after--pre">With one compound hint, I will not know which ’N’ and which is ‘U’</p><p name="a06b" id="a06b" class="graf graf--p graf-after--p">I’ll show this with the two internal states of ‘Unused’ by adding an additional cartesian join with DEMO0:</p><pre name="1492" id="1492" class="graf graf--pre graf-after--p">SQL&gt; explain plan for<br>     select <strong class="markup--strong markup--pre-strong">/*+ USE_HASH(demo0)</strong> <strong class="markup--strong markup--pre-strong">USE_HASH(demo1) USE_HASH(demo2) */</strong> *<br>     from <strong class="markup--strong markup--pre-strong">demo0 cross join</strong> demo1 join demo2 using(id);</pre><pre name="0a97" id="0a97" class="graf graf--pre graf-after--pre">Explained.</pre><pre name="b454" id="b454" class="graf graf--pre graf-after--pre">SQL&gt; select * from dbms_xplan.display(format=&gt;&#39;basic +rows <strong class="markup--strong markup--pre-strong">+hint_report</strong>&#39;);</pre><pre name="a2bf" id="a2bf" class="graf graf--pre graf-after--pre">PLAN_TABLE_OUTPUT <br>--------------------------------------------------------------------<br>Plan hash value: 61862555<br> <br>-----------------------------------------------<br>| Id  | Operation             | Name  | Rows  |<br>-----------------------------------------------<br>|   0 | SELECT STATEMENT      |       |     1 |<br>|   1 |  HASH JOIN            |       |     1 |<br>|   2 |   MERGE JOIN CARTESIAN|       |     1 |<br>|   3 |    TABLE ACCESS FULL  | DEMO0 |     1 |<br>|   4 |    BUFFER SORT        |       |     1 |<br>|   5 |     TABLE ACCESS FULL | DEMO1 |     1 |<br>|   6 |   TABLE ACCESS FULL   | DEMO2 |     1 |<br>-----------------------------------------------<br> <br>Hint Report (identified by operation id / Query Block Name / Object Alias):<br>Total hints for statement: 2 (<strong class="markup--strong markup--pre-strong">U - Unused</strong> (1))<br>--------------------------------------------------------------------<br> <br>   3 -  SEL$9E43CB6E / DEMO0@SEL$1<br>         <strong class="markup--strong markup--pre-strong">U -</strong>  USE_HASH(demo0)<br> <br>   5 -  SEL$9E43CB6E / DEMO1@SEL$1<br>         <strong class="markup--strong markup--pre-strong">U -</strong>  USE_HASH(demo1)<br> <br>   6 -  SEL$9E43CB6E / DEMO2@SEL$2<br>           -  USE_HASH(demo2)</pre><pre name="7fea" id="7fea" class="graf graf--pre graf-after--pre">SQL&gt; select cast(extract(xmltype(other_xml),&#39;//hint_usage/q/t/h&#39;) as varchar2(4000)) from plan_table where other_xml like &#39;%hint_usage%&#39;;</pre><pre name="c2eb" id="c2eb" class="graf graf--pre graf-after--pre">CAST(EXTRACT(XMLTYPE(OTHER_XML),&#39;//HINT_USAGE/Q/T/H&#39;)ASVARCHAR2(4000))<br>--------------------------------------------------------------------<br>&lt;h o=&quot;EM&quot;&gt;&lt;x&gt;&lt;![CDATA[USE_HASH(demo2)]]&gt;&lt;/x&gt;&lt;/h&gt;<br>&lt;h o=&quot;EM&quot; <strong class="markup--strong markup--pre-strong">st=&quot;EU&quot;</strong>&gt;&lt;x&gt;&lt;![CDATA[<strong class="markup--strong markup--pre-strong">USE_HASH(demo1)</strong>]]&gt;&lt;/x&gt;&lt;/h&gt;<br>&lt;h o=&quot;EM&quot; <strong class="markup--strong markup--pre-strong">st=&quot;NU&quot;</strong>&gt;&lt;x&gt;&lt;![CDATA[<strong class="markup--strong markup--pre-strong">USE_HASH(demo0)</strong>]]&gt;&lt;/x&gt;&lt;/h&gt;</pre><p name="273f" id="273f" class="graf graf--p graf-after--pre">The USE_HASH(demo0) is impossible because, as above, it is the first outer table. It has the internal unused state of ‘NU’. The USE_HASH(demo1) is a possible join but not used because the join type (cartesian) is incompatible with the hash join. The unusable state for it is ‘EU’. If you have any guess about those names (‘NU’/’EU’), or any comment, don’t forget my Twitter:</p><div name="1e18" id="1e18" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://twitter.com/FranckPachot" data-href="https://twitter.com/FranckPachot" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://twitter.com/FranckPachot"><strong class="markup--strong markup--mixtapeEmbed-strong">Franck Pachot (@FranckPachot) | Twitter</strong><br><em class="markup--em markup--mixtapeEmbed-em">The latest Tweets from Franck Pachot (@FranckPachot). 👨🏽‍💻 on databases at #CERN ♠️@OracleACE #ACED…</em>twitter.com</a><a href="https://twitter.com/FranckPachot" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="116aee57dd84452d090cfed9f2a85124" data-thumbnail-img-id="0*hgMvuzRqrR5it-lF" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*hgMvuzRqrR5it-lF);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/79702f06c735"><time class="dt-published" datetime="2019-04-26T20:17:25.118Z">April 26, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/avoid-compound-hints-for-better-hint-reporting-in-19c-79702f06c735" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>