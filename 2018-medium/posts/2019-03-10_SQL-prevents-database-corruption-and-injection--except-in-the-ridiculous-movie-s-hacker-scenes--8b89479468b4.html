<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>SQL prevents database corruption and injection, except in the ridiculous movie’s hacker scenes.</title><style>
      * {
        <!--font-family: Georgia, Cambria, "Times New Roman", Times, serif;-->
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">SQL prevents database corruption and injection, except in the ridiculous movie’s hacker scenes.</h1>
</header>
<section data-field="subtitle" class="p-summary">
SQL is the Structured Query Language used to define and manipulate data in most of the databases in the world, and the most critical ones…
</section>
<section data-field="body" class="e-content">
<section name="74df" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8339" id="8339" class="graf graf--h3 graf--leading graf--title">SQL prevents database corruption and injection, except in the ridiculous movie’s hacker scenes.</h3><p name="26ab" id="26ab" class="graf graf--p graf-after--h3">SQL is the Structured Query Language used to define and manipulate data in most of the databases in the world, and the most critical ones (banks, hospitals, airlines, secret services… ). And then, it gives the impression that with SQL you can do whatever you want, bypassing all application control, as if it were a backdoor to your database, wide opened on the network.</p><figure name="1eab" id="1eab" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 203px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 38.6%;"></div><img class="graf-image" data-image-id="1*cQar-lswQal7-Uw-Nc5-Tw.png" data-width="898" data-height="347" data-is-featured="true" src="https://cdn-images-1.medium.com/max/600/1*cQar-lswQal7-Uw-Nc5-Tw.png"></div><figcaption class="imageCaption">Superman 3 “overide all security” command</figcaption></figure><p name="dfc0" id="dfc0" class="graf graf--p graf-after--figure">Programmers always laugh when seeing ridiculous hacking scenes in movies. In 2016 there was this “<em class="markup--em markup--p-em">use SQL to corrupt their database</em>” line in <em class="markup--em markup--p-em">Jason Bourne</em> (nothing to do with JSON or /bin/sh, by the way, it’s a movie) and recently in <em class="markup--em markup--p-em">StarTrek: discovery</em> series the hacking &#39;audit&#39; was explained as “<em class="markup--em markup--p-em">The probe used multiple SQL injections</em>”. I’ve put the links at the end of this post.</p><p name="f53d" id="f53d" class="graf graf--p graf-after--p">I just want to explain that SQL is not a problem in this area, but can be the solution. SQL is not only a powerful language to manipulate data: it also has all features to encapsulate and protect the access to the database.</p><p name="b832" id="b832" class="graf graf--p graf-after--p">Actually, SQL is the implementation of Edgar F. Codd rule number 5:</p><figure name="2a6f" id="2a6f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 120px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 17.2%;"></div><img class="graf-image" data-image-id="1*wXu-xQ5dctCgCm-8pgGOGA.png" data-width="1528" data-height="263" src="https://cdn-images-1.medium.com/max/800/1*wXu-xQ5dctCgCm-8pgGOGA.png"></div><figcaption class="imageCaption"><a href="https://books.google.ch/books?id=x6PPDQAAQBAJ&amp;lpg=PA33&amp;dq=%22there%20must%20be%20at%20least%20one%20language%22%20%22whose%20statements%20are%20expressible%22&amp;pg=PA33#v=onepage&amp;q=%22Codd%27s%20fith%20rule%20states%22&amp;f=false" data-href="https://books.google.ch/books?id=x6PPDQAAQBAJ&amp;lpg=PA33&amp;dq=%22there%20must%20be%20at%20least%20one%20language%22%20%22whose%20statements%20are%20expressible%22&amp;pg=PA33#v=onepage&amp;q=%22Codd&#39;s%20fith%20rule%20states%22&amp;f=false" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Pro SQL Server Relational Database Design and Implementation</a><br>By Louis Davidson, Jessica Moss</figcaption></figure><p name="9795" id="9795" class="graf graf--p graf-after--figure">When one says that SQL is DDL (Data Definition Language) and DML (Data Manipulation Language), and forgets the DCL (Data Control Language), he suggests that we can do anything, like dropping or changing data, and forgets all this ‘authorization’ part. And DDL does not only CREATE and DROP the tables, but we can (and should) create views to implement the encapsulation of data access, like the ‘private’ and ‘public’ declarations we find in other languages. And stored procedure when we need a procedural language more complex rules.</p><p name="1619" id="1619" class="graf graf--p graf-after--p">If we can “use SQL to corrupt their database”, that’s not because of SQL. That’s because of the developers who did not care about security and maybe didn’t know that:</p><ul class="postList"><li name="3c8c" id="3c8c" class="graf graf--li graf-after--p">schemas should be used to isolate the different layers — internal ones vs. the ones exposed to the users</li><li name="e908" id="e908" class="graf graf--li graf-after--li">views must be used to hide the internal private columns or rows, and expose only the public ones. Views are not only for queries (SELECT), but also modifications (INSERT, UPDATE, DELETE) can be made on views.</li><li name="67cc" id="67cc" class="graf graf--li graf-after--li">grant/revoke table access must be done according to the visibility specification. Never do a GRANT ALL PRIVILEGES TO PUBLIC thinking that the front-end will guard all access.</li><li name="24b4" id="24b4" class="graf graf--li graf-after--li">stored procedures should be used to expose the application services, rather than giving direct DML access on tables or views to the front-end</li></ul><p name="f767" id="f767" class="graf graf--p graf-after--li">Here is a clear definition, by Philip Salvisberg, about the right design of database application where data is not exposed directly but through a secured application API defined in the database:</p><div name="8639" id="8639" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.salvis.com/blog/2018/07/18/the-pink-database-paradigm-pinkdb/" data-href="https://www.salvis.com/blog/2018/07/18/the-pink-database-paradigm-pinkdb/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.salvis.com/blog/2018/07/18/the-pink-database-paradigm-pinkdb/"><strong class="markup--strong markup--mixtapeEmbed-strong">The Pink Database Paradigm (PinkDB) - Philipp Salvisberg&#39;s Blog</strong><br><em class="markup--em markup--mixtapeEmbed-em">The Pink Database paradigm (PinkDB) is an application architecture for database centric applications. It is focusing on…</em>www.salvis.com</a><a href="https://www.salvis.com/blog/2018/07/18/the-pink-database-paradigm-pinkdb/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="9f0881a4296c1e15bf1acecdd6bf212a" data-thumbnail-img-id="0*gRi4u20_-pszNqwY" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*gRi4u20_-pszNqwY);"></a></div><p name="0248" id="0248" class="graf graf--p graf-after--mixtapeEmbed">With this, impossible to “use SQL to corrupt their database” because the SQL statements are not written by the user, but coded by the developer who implemented this API, with all access rules enforced. But then, what about hackers trying to change the API behavior by trying StarTreck’s “multiple SQL injections”?</p><h4 name="d00b" id="d00b" class="graf graf--h4 graf-after--p">SQL Injection</h4><p name="0c6d" id="0c6d" class="graf graf--p graf-after--h4">The idea is exposed in the following were a user can pass some SQL statements through the application API to tweak a SELECT statement and change it to be a DROP TABLE one:</p><div name="b238" id="b238" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://xkcd.com/327/" data-href="https://xkcd.com/327/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://xkcd.com/327/"><strong class="markup--strong markup--mixtapeEmbed-strong">xkcd: Exploits of a Mom</strong><br><em class="markup--em markup--mixtapeEmbed-em">xkcd.com is best viewed with Netscape Navigator 4.0 or below on a Pentium 3±1 emulated in Javascript on an Apple IIGS…</em>xkcd.com</a><a href="https://xkcd.com/327/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c2788726cccafa7e4126d3b29e52e6aa" data-thumbnail-img-id="0*64dspUQcojyfJWmN" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*64dspUQcojyfJWmN);"></a></div><p name="fef6" id="fef6" class="graf graf--p graf-after--mixtapeEmbed">But this, again, is not a weakness of SQL but the wrong design and misunderstanding of Codd’s Rule 5 which states that there is two way to manipulate data: “<strong class="markup--strong markup--p-strong">interactive</strong> and <strong class="markup--strong markup--p-strong">by program</strong>”. If the user is able to do this SQL injection, that’s because the developer has used the wrong one. Probably by laziness, he used the ad-hoc query language instead of the programmer’s one.</p><h4 name="5dca" id="5dca" class="graf graf--h4 graf-after--p">Interactive</h4><p name="f9bf" id="f9bf" class="graf graf--p graf-after--h4">Yes, SQL can be used by end-users and this is why it is a 4th generation declarative language, looking like an English sentence describing the result we want. Here, users can do data manipulation without the need to learn a procedural language. The security access, in this case, relies entirely upon the DDL (view definition) and DCL (privileges granted) after the end-user authentication (login with his username). The user has not been granted DROP TABLE privilege, and will never be able to do it.</p><p name="d49e" id="d49e" class="graf graf--p graf-after--p">But that is not correct when the application connects to the database with a generic account, like when one program runs to serve multiple users and transactions, because this account has probably more privileges to cope with the multiple user profiles.</p><h4 name="8185" id="8185" class="graf graf--h4 graf-after--p">By program</h4><p name="0cff" id="0cff" class="graf graf--p graf-after--h4">As Rule 5 mentions, the SQL language can be used by programs. There, it is not the user who writes the SQL statement. The SQL statement is coded in advance by the application developer. And it is parsed and compiled. And then it is executed, many times, for different end-users, with different parameters. In this case, SQL is not a simple text command passed as a character string to the database engine. Here, SQL defines a cursor that is prepared from a SQL text that contains some variables. And the cursor is executed, passing values to those variables. There is no way to ‘inject’ SQL in this because the user can inject only values to the parameters: he cannot inject code.</p><p name="70c9" id="70c9" class="graf graf--p graf-after--p">Do you take user input and build from it a string to pass to Runtime.exec() in Java or os.system() in Python? This is exactly what you do with something like:</p><pre name="d378" id="d378" class="graf graf--pre graf-after--p">Statement stmt = con.createStatement();<br>ResultSet rs=stmt.executeQuery(<br> &quot;select * from students where name=<strong class="markup--strong markup--pre-strong">&#39;&quot;+argv[1]+&quot;&#39;</strong>&quot;<br>);</pre><p name="3af0" id="3af0" class="graf graf--p graf-after--pre">This is subject to SQL injection because you can pass a value that will change the WHERE clause predicate.</p><p name="6c25" id="6c25" class="graf graf--p graf-after--p">The right way to program a database access is to prepare a statement (once), and then execute it:</p><pre name="e93d" id="e93d" class="graf graf--pre graf-after--p">Statement stmt=con.<strong class="markup--strong markup--pre-strong">prepare</strong>Statement(<br> &quot;select * from students where name=<strong class="markup--strong markup--pre-strong">:1</strong>&quot;<br>);<br>stmt.<strong class="markup--strong markup--pre-strong">set</strong>String(<strong class="markup--strong markup--pre-strong">1</strong>,<strong class="markup--strong markup--pre-strong">argv[1]</strong>);<br>ResultSet rs = stmt.<strong class="markup--strong markup--pre-strong">execute</strong>Query(stmt);</pre><p name="6e6d" id="6e6d" class="graf graf--p graf-after--pre">Here there’s no way to pass something else than a String value for the name column.</p><p name="7629" id="7629" class="graf graf--p graf-after--p">This is mandatory for security, but also for performance. Do you imagine that you compile a different program for each user input?</p><p name="48bf" id="48bf" class="graf graf--p graf-after--p">In summary, are you an end-user running ad-hoc queries or a professional programmer who builds a secured and efficient application? SQL is the right language for both, but you must pick the right approach. Or your code will be ridiculous like these movies hacking scenes:</p><h4 name="4046" id="4046" class="graf graf--h4 graf--startsWithDoubleQuote graf-after--p">“Use SQL to corrupt their database” (Jason Bourne, 2016)</h4><figure name="4288" id="4288" class="graf graf--figure graf--iframe graf-after--h4"><iframe src="https://www.youtube.com/embed/yY9nZhnvyLA?feature=oembed" width="700" height="393" frameborder="0" scrolling="no"></iframe></figure><h4 name="23d5" id="23d5" class="graf graf--h4 graf--startsWithDoubleQuote graf-after--figure">“The probe used multiple SQL injections” (<strong class="markup--strong markup--h4-strong">Star Trek: Discovery, 2019)</strong></h4><figure name="a4d0" id="a4d0" class="graf graf--figure graf--iframe graf-after--h4"><blockquote class="twitter-tweet"><a href="https://twitter.com/g_sohal/status/1104007174357958656?s=20"></a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></figure><h4 name="729c" id="729c" class="graf graf--h4 graf-after--figure">Where to learn?</h4><p name="dd71" id="dd71" class="graf graf--p graf-after--h4">There are many resources about using prepared statements, but the best multi-database multi-language I know is from Markus Winand:</p><div name="885e" id="885e" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://use-the-index-luke.com/sql/where-clause/bind-parameters" data-href="https://use-the-index-luke.com/sql/where-clause/bind-parameters" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://use-the-index-luke.com/sql/where-clause/bind-parameters"><strong class="markup--strong markup--mixtapeEmbed-strong">SQL Bind Variables/Parameters in LANGTYPE{databases}</strong><br><em class="markup--em markup--mixtapeEmbed-em">This section covers a topic that is skipped in most SQL textbooks: parameterized queries and bind parameters. Bind…</em>use-the-index-luke.com</a><a href="https://use-the-index-luke.com/sql/where-clause/bind-parameters" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="57c633e6e7a1526f82853d02a4cc144f" data-thumbnail-img-id="0*lJGNac9zVIZ9aAWe" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*lJGNac9zVIZ9aAWe);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@FranckPachot" class="p-author h-card">Franck Pachot</a> on <a href="https://medium.com/p/8b89479468b4"><time class="dt-published" datetime="2019-03-10T20:00:17.341Z">March 10, 2019</time></a>.</p><p><a href="https://medium.com/@FranckPachot/sql-prevents-database-corruption-and-injection-except-in-the-ridiculous-movies-hacker-scenes-8b89479468b4" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 27, 2019.</p></footer></article></body></html>